!function(t,e,n){!function(e){"function"==typeof define&&define.amd?define(["underscore"],e):"object"==typeof exports?module.exports=e(require("underscore")):t.Waffle=e(_)}(function(t){"use strict";var i=function(){var e=function(n){return n instanceof e?n:this instanceof e?(t.isElement(n)&&(n=[n]),t.forEach(n,function(t,e){this[e]=t},this),this.length=n.length,void(this.$$events=[])):new e(n)},n=function(t,e,n,i){i.addEventListener(e,n),t.$$events.push({event:e,callback:n,node:i})},i=function(t,e,n,i){i.removeEventListener(e,n)},r=function(e,n){return t.forEach(e,n,e),e};return e.prototype={children:function(){var n=[];return r(this,function(e){t.forEach(e.childNodes,function(t){1===t.nodeType&&n.push(t)})}),new e(n)},eq:function(t){return new e(this[t])},on:function(t,e){return r(this,function(i){n(this,t,e,i)})},off:function(){for(var t=0,e=this.$$events.length;e>t;++t){var n=this.$$events[t];i(this,n.event,n.callback,n.node)}this.$$events=[]},empty:function(){return r(this,function(t){for(;t.firstChild;)t.removeChild(t.firstChild)})},append:function(t){return r(this,function(e,n,i){var r=n===i.length-1?t:t.cloneNode(!0);e.appendChild(r)})},prepend:function(t){return r(this,function(e,n,i){var r=n===i.length-1?t:t.cloneNode(!0);e.insertBefore(r,e.childNodes[0])})},after:function(t){return r(this,function(e,n,i){var r=n===i.length-1?t:t.cloneNode(!0);e.parentNode.insertBefore(r,e.nextSibling)})},css:function(e,n){var i,s;return t.isObject(e)?(i=e,s=t.keys(i)):(i={},i[e]=n,s=[e]),r(this,function(e){t.forEach(s,function(t){e.style[t]=i[t]})})},addClass:function(t){return r(this,function(e){var n=e.className;e.className=(n?n+" ":"")+t})},removeClass:function(e){var n=e.split(" "),i=t.indexBy(n,function(t){return t});return r(this,function(e){var n=e.className,r=t.filter(n.split(" "),function(t){return!i[t]});e.className=r.join(" ")})},html:function(t){return r(this,function(e){e.innerHTML=t})},attr:function(e,n){var i,s=e;return 2===arguments.length?(s={},s[e]=n,i=[e]):i=t.keys(s),r(this,function(e){t.forEach(i,function(t){e.setAttribute(t,s[t])})})},removeAttr:function(t){return r(this,function(e){e.removeAttribute(t)})},prop:function(t,e){return r(this,function(n){n[t]=e})}},e}(),r=function(e){var i=r.$split(e),s=i.length;return function(e){for(var r=e,o=0;s>o;++o){if(null==r||!t.isObject(r))return n;r=t.result(r,i[o])}return r}};r.$normalize=function(t){for(var e=[],n=t.split("."),i=/(.+?)?(\[(\d+)\])/,r=/(.+?)?(\['(.+)'\])/,s=/(.+?)?(\["(.+)"\])/,o=function(t,e,n,i){var r=e?e+".":"";return r+i},a=0,h=n.length;h>a;++a){var c=n[a].replace(i,o).replace(r,o).replace(s,o),u=c.indexOf("(");u>0&&(c=c.slice(0,u)),e[a]=c}return e.join(".")},r.$split=function(t){return r.$normalize(t).split(".")};var s=function(t){var n=e.createElement("div");return n.appendChild(e.createTextNode(t)),n.innerHTML},o="waffle-",a="waffle-grid",h=o+"sortable",c=h+"-asc",u=h+"-desc",l=o+"fixedheader",d=o+"selectable",f=o+"selected",p=o+"checkbox",v="data-waffle-",$=v+"id",g=v+"sortable",m=v+"order",b=v+"idx",y="+",C="-",x=function(){var e="key_",n=function(t){return e+t},i=function(){return this instanceof i?void(this.$o={}):new i};return i.prototype={clear:function(){this.$o={}},put:function(t,e){return this.$o[n(t)]=e,this},get:function(t){return this.$o[n(t)]},remove:function(t){return delete this.$o[n(t)],this},contains:function(e){return t.has(this.$o,n(e))}},i}(),k={toPx:function(e){return t.isNumber(e)?e+"px":e},fromPx:function(e){return t.isString(e)?Number(e.replace("px","")):e},capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},destroy:function(e){for(var n in e)t.has(e,n)&&(e[n]=null)},asyncTask:function(t,e,n,i){var r=0,s=function(){if(t.length>0){var o=t.shift();n(o,r),r+=o.length,t.length>0?setTimeout(s,e):(i(),s=null)}};setTimeout(s)}},w=function(){var n=function(){var t=e.createElement("div");t.style.width="100px",t.style.height="100px",t.style.overflow="scroll",t.style.position="absolute",t.style.top="-9999px",e.body.appendChild(t);var n=t.offsetWidth-t.clientWidth;return e.body.removeChild(t),n},i=function(){return"body"},r={create:function(t){return e.createElement(t)},byId:function(t){var n=e.getElementById(t);return n?[n]:[]},byTagName:function(t,n){return(n||e).getElementsByTagName(t)},createFragment:function(){return e.createDocumentFragment()},findParent:function(t,e){for(;t&&t.tagName!==e;)t=t.parentNode;return t},updateAttributes:function(e,n){var i=e.attributes,r=n.attributes;t.forEach(r,function(t,n){var s=i[n].value,o=r[n].value;s!==o&&e.setAttribute(t.name,o)})},updateClassName:function(t,e){var n=t.className,i=e.className;n!==i&&(t.className=e.className)},updateContent:function(t,e){var n=t.innerHTML,i=e.innerHTML;n!==i&&(t.innerHTML=i)},scrollbarWidth:t.memoize(n,i)};return t.forEach(["tr","td","th","tbody","thead","tfoot","input","span"],function(t){r[t]=function(){return this.create(t)}}),t.forEach(["text","checkbox"],function(t){var e="input"+k.capitalize(t);r[e]=function(){var e=this.input();return e.setAttribute("type",t),e}}),r}(),N=function(){var e=t.noop,n=function(e,n,i){this.type=e,this.bubbles=!1,this.cancelable=!1,this.details=i,this.target=n,this.currentTarget=n,this.timeStamp=t.now()};n.prototype={preventDefault:e,stopPropagation:e,stopImmediatePropagation:e};var i=function(t){return t.toLowerCase()},r=function(){this.$events={}};return r.prototype={addEventListener:function(t,e){var n=i(t),r=this.$events,s=r[n]=r[n]||[];s.push(e)},removeEventListener:function(e,n){var r=i(e),s=this.$events[r];s&&s.length&&(this.$events[r]=t.reject(s,function(t){return t===n}))},dispatchEvent:function(e,r,s){r=i(r);var o=this.$events[r];if(o&&o.length)for(var a=new n(r,e,t.isFunction(s)?s.call(e):s),h=0,c=o.length;c>h;++h)try{o[h].call(e,a)}catch(u){}},clear:function(){this.$events={}}},r}(),E=function(){var e=function(t){return t&&t.length>0},n=function(t){t.callback.call(t.ctx,this.$$changes)},i=function(){var i=this.$$changes,r=this.$$observers;e(i)&&e(r)&&t.forEach(r,n,this),this.clearChanges()},r={observe:function(t,e){return this.$$observers=this.$$observers||[],this.$$observers.push({ctx:e||null,callback:t}),this},unobserve:function(n,i){if(e(this.$$observers))if(0===arguments.length)this.$$observers=[];else{var r=i||null;this.$$observers=t.reject(this.$$observers,function(t){return t.ctx===r&&n===t.callback})}return this},trigger:function(e){return this.$$changes=(this.$$changes||[]).concat(e),setTimeout(t.bind(i,this)),this},clearChanges:function(){return this.$$changes=[],this}};return r}(),A=function(){var e=Array.prototype,i=function(){try{var t={};return t[0]=1,!!e.toString.call(t)}catch(n){return!1}}(),s=function(n){return function(){var r=i?this:t.toArray(this);return e[n].apply(r,arguments)}},o=function(t,e,n){return s(t).apply(e,n)},a=function(e,n){var i=n||{};this.$$map=new x,this.$$model=i.model||Object,this.$$key=i.key||"id",t.isFunction(this.$$key)||(this.$$key=r(this.$$key)),this.length=0,e&&e.length&&this.push.apply(this,e)},h=function(t){return parseInt(Number(t)||0,10)},c="splice",u="update",l=function(t,e,n,i,r){return{type:t,removed:e,index:n,addedCount:i,object:r}},d=function(t,e){delete t[e]},f=function(t,e){t.$$map.remove(e)},p=function(t,e){var n=t.$$key(e),i=t.$$map.get(n),r=i?i.idx:null;null!=r&&(d(t,r),f(t,n))},v=function(e,n){if(!t.isObject(n))throw new Error("Waffle collections are not array, only object are allowed");return n instanceof e.$$model?n:new e.$$model(n)},$=function(t,e,n,i){if(t[n]=e,null!=e){var r=arguments.length,s=3===r?t.$$key(e):i,o=t.$$map.get(s)||{};o.idx=n,t.$$map.put(s,o)}},g=function(t,e){var n=t.indexOf(e);return t[n]=e,l(u,[],n,0,t)},m=function(t,e,n){var i=t.at(n),r=t.at(e);$(t,r,n),$(t,i,e)},b=function(t,e,n){for(var i=Math.abs(n),r=t.length-1;r>=e;--r)m(t,r,r+i);t.length+=i},y=function(t,e,n){for(var i=Math.abs(n),r=t.length,s=r-i,o=e+i,a=[],h=o;r>h;++h)m(t,h,h-i);for(var c=s;r>c;++c){var u=t.at(c);a.unshift(u),p(t,u)}return t.length=s,a},C=function(e,n){for(var i,r=e.$$sortFn,s=e.length,o=n.length,a=s+o,h=[],u=s-1,d=o-1,f=a-1;f>=0;--f)if(0>u||r(e[u],n[d])<0){if($(e,n[d--],f),i=t.first(h),i&&i.index===f+1?(i.index=f,i.addedCount++):(i=l(c,[],f,1,e),h.unshift(i)),0>d)break}else $(e,e[u--],f);return e.length=a,h};return a.prototype={options:function(){return{model:this.$$model,key:this.$$key}},at:function(t){return this[t]},byKey:function(t){var e=this.indexOf(t);return e>=0?this.at(e):n},indexOf:function(e){var n=t.isObject(e)?this.$$key(e):e;return this.$$map.contains(n)?this.$$map.get(n).idx:-1},contains:function(t){return this.indexOf(t)>=0},findIndex:function(t,e){for(var n=0,i=this.length;i>n;++n)if(t.call(e,this.at(n),n,this))return n;return-1},add:function(t,e){var n=null==e?this.length:e,i=[n,0].concat(t);return this.splice.apply(this,i),this.length},remove:function(e,n){if(t.isNumber(e))return this.splice.call(this,e,n||this.length);if(t.isArray(e)){var i=this.$$key,r=t.indexBy(e,i);return this.remove(function(t){return!!r[i(t)]})}for(var s=e,o=n,a=0,h=null,u=[],p=[],v=0,g=this.length;g>v;++v){var m=this.at(v),b=this.$$key(m);s.call(o,m,v)?(d(this,v),f(this,b),h===v-1?t.last(u).removed.push(m):u.push(l(c,[m],v,0,this)),p.push(m),h=v):(a!==v&&(d(this,v),f(this,b),$(this,m,a,b)),a++)}return this.length-=p.length,u.length>0&&this.trigger(u),p},replace:function(t){var e=[0,0].concat(t);return this.splice.apply(this,e),this},push:function(){return this.add.call(this,t.toArray(arguments))},unshift:function(){return this.add.call(this,t.toArray(arguments),0)},pop:function(){return this.remove(this.length-1,1)[0]},shift:function(){return this.remove(0,1)[0]},toggle:function(t){var e=this.indexOf(t);return e>=0?this.remove(e,1):this.push(t)},clear:function(){if(this.length>0){for(var t=[],e=0,n=this.length;n>e;++e)t[e]=this.at(e),d(this,e);this.$$map.clear(),this.length=0,this.trigger(l(c,t,0,0,this))}return this},reset:function(t){var e=this.length,n=t.length,i=this.$$sortFn;i&&t.sort(i),this.$$map.clear();for(var r=[],s=t.length,o=0;n>o;++o)e>o&&r.push(this.at(o)),$(this,v(this,t[o]),o);for(;e>o;++o)r.push(this.at(o)),d(this,o);return this.length=n,this.trigger([l(c,r,0,s,this)]),this},isEmpty:function(){return 0===this.length},concat:function(){var t=e.concat.apply(this.toArray(),arguments);return new a(t,this.options())},slice:function(){var t=o("slice",this,arguments);return new a(t,this.options())},splice:function(e,n){var i=this.$$sortFn,r=this.length,s=t.rest(arguments,2),o=function(t){return v(this,t)},a=t.map(s,o,this),u=h(e);u=u>=0?Math.min(r,u):Math.max(r+u,0);var d=Math.min(Math.max(h(n)||0,0),r-u),f=[];if(d>0){for(var p=0;d>p;++p)f.push(this[p+u]);y(this,u,d)}var m,x=t.groupBy(a,this.contains,this),k=x[!0]||[],w=x[!1]||[],N=w.length,E=k.length;if(N>0)if(i)w.sort(i),m=C(this,w);else{b(this,u,N);for(var A=0;N>A;++A)$(this,w[A],u+A);m=[l(c,f,u,N,this)]}else m=[];if(f.length>0){var T=t.find(m,function(t){return t.index===u});T?T.removed=f:m.unshift(l(c,f,u,0,this))}var S=[];if(E>0){i&&k.sort(i);for(var B=0;E>B;++B)S.push(g(this,k[B]))}var z=m.concat(S);return z.length>0&&this.trigger(z),f},reverse:function(){if(this.$$sortFn)return this;for(var t=this.length,e=Math.floor(t/2),n=[],i=[],r=0,s=t-1;e>r;++r,--s)m(this,r,s),n.push(l(u,[],r,0,this)),i.unshift(l(u,[],s,0,this));var o=n.concat(i);return o.length&&this.trigger(o),this},split:function(t){for(var e=t||20,n=[],i=[],r=0,s=this.length;s>r;++r)i.push(this.at(r)),i.length===e&&(n.push(i),i=[]);return i.length>0&&n.push(i),n},toJSON:function(){return JSON.stringify(this.toArray())},sort:function(t){return this.$$sortFn=t,this.reset(this.toArray()).clearChanges()},pluck:function(t){return this.map(r(t))}},a.prototype.lastIndexOf=a.prototype.indexOf,t.extend(a.prototype,E),t.forEach(["size","first","last","initial","rest","partition","forEach","map","every","some","reduce","reduceRight","filter","reject","find","toArray"],function(e){t[e]&&(a.prototype[e]=function(){var n=[this].concat(t.toArray(arguments));return t[e].apply(t,n)})}),t.forEach(["countBy","groupBy","indexBy"],function(e){a.prototype[e]=function(n,i){return t.isString(n)&&(n=r(n)),t[e].call(t,this,n,i)}}),t.forEach(["toString","toLocaleString","join"],function(t){a.prototype[t]=s(t)}),a}(),T=function(){var e=function(t){return(null==t?"":t).toString()},n={$identity:t.identity,$empty:function(){return""},$lowercase:function(t){return e(t).toLowerCase()},$uppercase:function(t){return e(t).toUpperCase()},$capitalize:function(t){return k.capitalize(e(t))},$get:function(t){return n[t]}};return n}(),S={$string:function(t,e){var n=null==t?"":String(t),i=null==e?"":String(e);return n.localeCompare(i)},$number:function(t,e){var n=null==t?0:Number(t),i=null==e?0:Number(e);return n-i},$boolean:function(t,e){var n="false"===t?0:Boolean(t)?1:0,i="false"===e?0:Boolean(e)?1:0;return n-i},$date:function(t,e){var n=new Date(null==t?0:t).getTime(),i=new Date(null==e?0:e).getTime();return n-i},$auto:function(e,n){if(e===n||null==e&&null==n)return 0;var i=t.find(["Number","Boolean","Date","String"],function(i){var r=t["is"+i];return r(e)||r(n)});return i?S["$"+i.toLowerCase()](e,n):n>e?-1:1},$get:function(t){return S[t]}},B=function(e){return t.isArray(e)||(e=[e]),function(t,n){if(t===n||null==t&&null==n)return 0;for(var i=0,r=e.length;r>i;++i){var s=e[i],o=s.parser(t),a=s.parser(n),h=s.fn.call(S,o,a);if(h)return s.desc?-1*h:h}return 0}},z=function(){var e={".":"-","(":"",")":"","[":"-","]":"-","'":"",'"':""},n=t.isUndefined,i="$identity",o="$auto",a=k.fromPx,l=k.toPx,d=function(e,n,i){return t.isString(e)&&(e=n.$get(e)),t.isFunction(e)||(e=n.$get(i)),e},f=function(h){var c=h.escape,u=h.sortable;if(this.id=h.id,this.title=h.title||"",this.field=h.field||this.id,this.css=h.css||"",this.escape=n(c)?!0:!!c,this.width=a(h.width),this.sortable=n(u)?!0:!!u,this.asc=n(h.asc)?null:!!h.asc,!this.css)for(var l=0,f=this.id.length;f>l;++l){var p=this.id.charAt(l),v=e[p];this.css+=null!=v?v:p}c&&(this.title=s(this.title));var $=h.renderer||i,g=t.isArray($)?$:[$];this.$renderer=t.map(g,function(t){return d(t,T,i)}),this.$comparator=d(h.comparator,S,o),this.$parser=r(this.field)};return f.prototype={cssClasses:function(){var t=[this.css];this.sortable&&t.push(h);var e=this.asc;return null!=e&&t.push(e?c:u),t.join(" ")},attributes:function(t,e){var n={};if(n[$]=this.id,e&&this.sortable){n[g]=!0;var i=this.asc;null!=i&&(n[m]=i?y:C)}return n},styles:function(){var t={},e=l(this.width);return e&&(t.width=e,t.maxWidth=e,t.minWidth=e),t},updateWidth:function(t){return this.width=a(t),this},render:function(e){var n=this.field,i=null==e?"":this.$parser(e),r=t.reduce(this.$renderer,function(t,i){return i.call(T,t,e,n)},i);return null==r?"":this.escape?s(r):r}},f}(),O={theadRow:function(t){var e=w.tr();return t.hasCheckbox()&&e.appendChild(O.theadCheckboxCell(t)),t.$columns.forEach(function(n,i){e.appendChild(O.theadCell(t,n,i))}),e},theadCell:function(t,e,n){return i(w.th()).addClass(e.cssClasses(n,!0)).css(e.styles(n,!0)).attr(e.attributes(n,!0)).html(e.title)[0]},theadCheckboxCell:function(t){var e=t.$selection.size(),n=t.$data.size(),r=i(w.span()).attr("title",e).html(e),s=i(w.inputCheckbox()).prop("checked",t.isSelected()).prop("indeterminate",e>0&&e!==n);return i(w.th()).addClass(p).append(r[0]).append(s[0])[0]},tfootRow:function(t){var e=w.tr();return t.hasCheckbox()&&e.appendChild(O.tfootCheckboxCell(t)),t.$columns.forEach(function(n,i){e.appendChild(O.tfootCell(t,n,i))}),e},tfootCell:function(t,e,n){return O.theadCell(t,e,n)},tfootCheckboxCell:function(t){var e=O.theadCheckboxCell(t);return e.appendChild(e.childNodes[0]),e},tbodyRows:function(t,e,n){for(var i=w.createFragment(),r=0,s=e.length;s>r;++r)i.appendChild(O.tbodyRow(t,e[r],n+r));return i},tbodyRow:function(t,e,n){var r=i(w.tr());return r.attr(b,n),t.isSelectable()&&t.$selection.contains(e)&&r.addClass(f),t.hasCheckbox()&&r[0].appendChild(O.tbodyCheckboxCell(t,e)),t.$columns.forEach(function(n,i){r[0].appendChild(O.tbodyCell(t,e,n,i))}),r[0]},tbodyCell:function(t,e,n,r){return i(w.td()).addClass(n.cssClasses(r,!1)).css(n.styles(r,!1)).attr(n.attributes(r,!1)).html(n.render(e))[0]},tbodyCheckboxCell:function(t,e){var n=i(w.inputCheckbox()).prop("checked",t.isSelected(e));return i(w.td()).addClass(p).append(n[0])[0]}},j=function(){var e="THEAD",n="TFOOT",i="TBODY",r="TH",s="TR",o="INPUT",a=function(t){return t.tagName===o&&"checkbox"===t.getAttribute("type")},h=function(e,n){var i=e.target,s=w.findParent(e.target,r);if(i.tagName!==n)if(this.isSelectable()&&a(i))i.checked?this.select():this.deselect();else if(s&&s.getAttribute(g)){var o,h=s.getAttribute($),c=s.getAttribute(m)||C,u=c===y?C:y,l=u+h;if(e.shiftKey){var d=c+h;o=t.reject(this.$sortBy,function(t){return t===d})}else o=[];o.push(l),this.sortBy(o)}},c={onClickThead:function(t){return h.call(this,t,e)},onClickTfoot:function(t){return h.call(this,t,n)},onClickTbody:function(t){if(this.isSelectable()&&t.target.tagName!==i){var e=w.findParent(t.target,s),n=e.getAttribute(b),r=this.$data.at(n),o=this.$selection;if(this.options.selection.multi)if(t.shiftKey){for(var a=parseFloat(n),h=parseFloat(this.$$selectAnchor),c=Math.min(a,h),u=Math.max(a,h),l=[],d=c;u>=d;++d){var f=this.$data.at(d);o.contains(f)||l.push(f)}l.length>0&&o.push.apply(o,l)}else o.toggle(r),this.$$selectAnchor=n;else{var p=o.indexOf(r);p>=0?o.remove(p,1):o.reset([r])}}}};return c}(),L={on:function(e,n){return t.forEach(n,function(t){var n="on"+k.capitalize(t.type);L[n].call(L,e,t)}),this},onSplice:function(e,n){var i,r,s,o=e.$tbody,a=o[0],h=a.childNodes,c=n.index,u=n.addedCount,l=n.object,d=n.removed,f=d.length;if(f>0){if(0===c&&f===h.length)i=t.toArray(h),o.empty();else{i=[];for(var p=0;f>p;++p)i.push(a.removeChild(h[c]))}var v=e.$selection;v&&v.length>0&&v.remove(d)}if(u>0){r=[],s=[];for(var $=w.createFragment(),g=0;u>g;++g){var m=g+c,y=l.at(m),C=O.tbodyRow(e,y,m);r.push(C),s.push(y),$.appendChild(C)}c>0?o.children().eq(c-1).after($):o.prepend($)}if(i||r){for(var x=c+u,k=h.length;k>x;++x)h[x].setAttribute(b,x);e.dispatchEvent("dataspliced",{added:s||[],addedNodes:r||[],removedNodes:i||[],removed:d,index:c})}return this},onUpdate:function(e,n){var i=n.index,r=e.$data.at(i),s=e.$tbody[0],o=s.childNodes[i],a=O.tbodyRow(e,r,i);w.updateAttributes(o,a),w.updateClassName(o,a);var h=o.childNodes,c=a.childNodes;return t.forEach(c,function(t,e){var n=h[e];w.updateAttributes(n,t),w.updateClassName(n,t),w.updateContent(n,t)}),e.dispatchEvent("dataupdated",{updatedNode:o}),this}},F=function(){var e=function(t){return t.childNodes[0].childNodes[0]},n=function(t,e){t.checked=e},r={on:function(e,n){return t.forEach(n,function(t){var n="on"+k.capitalize(t.type),i=F[n];i&&i.call(F,e,t)}),this},onSplice:function(t,r){var s,o,a=t.$tbody,h=t.$data,c=r.object,u=a[0],l=u.childNodes,d=r.index,p=r.removed,v=r.addedCount,$=p.length;if($>0)for(var g=0;$>g;++g)s=h.indexOf(p[g]),s>=0&&(o=l[s],i(o).removeClass(f),t.hasCheckbox()&&n(e(o),!1));if(v>0)for(var m=0;v>m;++m)s=h.indexOf(c.at(d+m)),o=l[s],i(o).addClass(f),t.hasCheckbox()&&n(e(o),!0);if(v>0||$>0){var b=v-$;if(b&&t.hasCheckbox()){var y=c.length,C=t.$thead[0],x=t.$tfoot[0],k=C.childNodes[0].childNodes[0],w=k.childNodes[0],N=k.childNodes[1],E=x.childNodes[0].childNodes[0],A=E.childNodes[1],T=E.childNodes[0];A.innerHTML=w.innerHTML=y,A.title=w.title=y,T.checked=N.checked=t.isSelected(),T.indeterminate=N.indeterminate=y>0&&h.length!==y}t.dispatchEvent("selectionchanged",function(){return{selection:this.$selection.toArray()}})}return this}};return r}(),M=function(){var e=k.toPx,n=k.fromPx,s=function(e){var n=e||[];return t.isArray(n)||(n=[n]),t.map(n,function(t){var e=t.charAt(0);return e!==y&&e!==C?y+t:t})},o=function(t){var e="$"+t,n=this.$table;this[e]=i(w.byTagName(t,n[0])),this[e].length||(this[e]=i(w[t]())),n.append(this[e][0])},h=function(t){return L.on(this,t)},f=function(t){return F.on(this,t)},p=function(t){var e=this.options.events[t];e&&this.addEventListener(t.slice(2),this.options.events[t])},v=function(e,r){if(!(this instanceof v))return new v(e,r);var s=r=r||{},c=v.options;t.forEach(["events","selection","size"],function(e){var n=s[e];(t.isObject(n)||t.isUndefined(n))&&(s[e]=t.defaults(n||{},c[e]))}),this.options=t.defaults(s,c),s.size={width:n(s.size.width),height:n(s.size.height)},s.scrollable=s.scrollable||!!s.size.height;var u=this.isSelectable(),$=this.isSortable(),g=s.scrollable;this.$table=i(e),this.$data=new A(s.data,{key:s.key,model:s.model}),$||t.forEach(s.columns,function(t){t.sortable=!1}),this.$columns=new A(s.columns,{key:"id",model:z}),this.$sortBy=[],this.$table.addClass(a),u&&this.$table.addClass(d),g&&this.$table.addClass(l),t.forEach(["thead","tbody","tfoot"],o,this),(u||$)&&(this.$thead.on("click",t.bind(j.onClickThead,this)),this.$tfoot.on("click",t.bind(j.onClickTfoot,this))),this.$data.observe(h,this),u&&(this.$selection=new A([],this.$data.options()),this.$tbody.on("click",t.bind(j.onClickTbody,this)),this.$selection.observe(f,this)),this.$bus=new N,t.forEach(t.keys(s.events),p,this),(s.size.height||s.size.width)&&this.assignWidth(),this.renderHeader().renderFooter().sortBy(r.sortBy,!1).renderBody(),this.dispatchEvent("initialized")};return v.create=function(t,e){return new v(t,e)},v.prototype={data:function(){return this.$data},columns:function(){return this.$columns},selection:function(){return this.$selection},isSortable:function(){return this.options.sortable},isSelectable:function(){var t=this.options.selection;return t&&t.enable},hasCheckbox:function(){return this.isSelectable()&&this.options.selection.checkbox},isSelected:function(t){if(!this.isSelectable())return!1;if(t)return this.$selection.contains(t);var e=this.$data.length,n=this.$selection.length;return e>0&&e===n},render:function(){return this.renderHeader().renderFooter().renderBody()},assignWidth:function(){var t=this.options.size,n=t.width;if(t.height){var i=e(t.width);this.$table.css({width:i,maxWidth:i,minWidth:i}),this.$tbody.css({maxHeight:e(t.height)}),n-=w.scrollbarWidth(),this.hasCheckbox()&&(n-=30)}var r=0,s=0;this.$columns.forEach(function(t){var e=t.width;e&&(r+=e,++s)});var o=this.$columns.length,a=o-s,h=0,c=0;if(a){var u=(n-r)/a;h=Math.floor(u),c=u-h}var l=0;return this.$columns.forEach(function(t){var e=t.width,n=e||0;n||(l+=c,l>=1?(n=h+1,l--):n=h),n!==e&&t.updateWidth(n)}),this},renderHeader:function(){var t=O.theadRow(this);return this.$thead.empty().append(t),this},renderFooter:function(){var t=O.tfootRow(this);return this.$tfoot.empty().append(t),this},renderBody:function(e){var n=null==e?this.options.async:e,i=this,r=t.once(function(){i.$tbody.empty()}),s=function(t,e){var n=O.tbodyRows(i,t,e);r(),i.$tbody.append(n)},o=function(){i.$data.clearChanges(),i.dispatchEvent("rendered",function(){return{data:this.$data,nodes:t.toArray(this.$tbody[0].childNodes)}}),i=r=s=o=null};return n?k.asyncTask(this.$data.split(200),10,s,o):(s(this.$data,0),o()),this},select:function(){return this.$selection.length!==this.$data.length&&this.$selection.add(this.$data.toArray()),this},deselect:function(){return this.$selection.isEmpty()||this.$selection.clear(),this},sortBy:function(e,n){var i=s(e);if(this.$sortBy===i||this.$sortBy.join()===i.join())return this;this.$sortBy=i;var o=this.$thead.children().eq(0).children(),a=this.$tfoot.children().eq(0).children();o.removeClass(c+" "+u).removeAttr(m),a.removeClass(c+" "+u).removeAttr(m);var h=this.$columns,l=this.hasCheckbox(),d=t.map(this.$sortBy,function(t){var e,n=t.charAt(0),i=t.substr(1),s=n===y,d=h.indexOf(i),f=l?d+1:d;return d>=0?(e=h.at(d),e.asc=s,o.eq(f).addClass(s?c:u).attr(m,n),a.eq(f).addClass(s?c:u).attr(m,n)):e={},{parser:e.$parser||r(t),fn:e.$comparator||S.$auto,desc:!s}});return this.$data.sort(B(d)),n!==!1&&this.renderBody(),this.dispatchEvent("sorted")},dispatchEvent:function(t,e){return this.$bus.dispatchEvent(this,t,e),this},addEventListener:function(t,e){return this.$bus.addEventListener(t,e),this},removeEventListener:function(t,e){return this.$bus.removeEventListener(t,e),this},destroy:function(){this.$thead.off(),this.$tfoot.off(),this.$tbody.off(),this.$data.unobserve(),this.$selection.unobserve(),this.$bus.clear(),k.destroy(this)}},v.options={key:"id",async:!1,scrollable:!1,sortable:!0,selection:{enable:!0,checkbox:!0,multi:!1},size:{width:null,height:null},events:{}},t.forEach(["onInitialized","onRendered","onDataSpliced","onDataUpdated","onSelectionChanged","onSorted"],function(t){v.options.events[t]=null}),v}(),R={Grid:M,addRenderer:function(t,e){return T[t]=e,R},addComparator:function(t,e){return S[t]=e,R}};return R})}(window,document,void 0);