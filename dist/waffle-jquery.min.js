!function(t,e,n){!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):t.Waffle=e(jQuery)}(function(r){"use strict";var i=function(){var t=Array.prototype,e=t.slice,r=Object.prototype,i=Object.keys,o=r.hasOwnProperty,a=r.toString,s=Function.prototype.bind,u=function(t){return h.isString(t)?function(e){return e[t]}:t},l=function(t){return function(e,n,r){for(var i={},o=u(n),a=0,s=e.length;s>a;++a){var l=o.call(r,e[a],a,e);t(i,e[a],l)}return i}},h={};return h.isNull=function(t){return null===t},h.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"===a.call(t)},h.bind=function(t,e){return s?t.bind(e):function(){return t.apply(e,arguments)}},h.constant=function(t){return function(){return t}},h.toArray=function(t){return h.map(t,function(t){return t})},h.isNaN=function(t){return h.isNumber(t)&&t!==+t},h.once=function(t){var e,n=!1;return function(){return n||(n=!0,e=t.apply(this,arguments),t=null),e}},h.defaults=function(t,e){return h.forEach(h.keys(e),function(n){h.isUndefined(t[n])&&(t[n]=e[n])}),t},h.result=function(t,e){var n=t[e];return h.isFunction(n)?n.call(t):n},h.has=function(t,e){return o.call(t,e)},h.size=function(t){return null==t?0:t.length},h.first=function(t,n){return null==n?t[0]:e.call(t,0,n)},h.last=function(t,n){return null==n?t[t.length-1]:e.call(t,t.length-n,t.length)},h.rest=function(t,n){var r=arguments.length>1?n:1;return e.call(t,r,t.length)},h.initial=function(t,n){var r=t.length,i=arguments.length>1?r-n:r-1;return e.call(t,0,i)},h.indexOf=function(t,e){for(var n=0,r=t.length;r>n;++n)if(t[n]===e)return n;return-1},h.lastIndexOf=function(t,e){for(var n=t.length-1;n>=0;--n)if(t[n]===e)return n;return-1},h.contains=function(t,e){return h.indexOf(t,e)>=0},h.keys=function(t){if(!h.isObject(t))return[];if(i)return i(t);var e=[];for(var n in t)h.has(t,n)&&e.push(n);return e},h.functions=function(t){var e=[];for(var n in t)h.isFunction(t[n])&&e.push(n);return e.sort()},h.map=function(t,e,n){for(var r=[],i=0,o=t.length;o>i;++i)r[i]=e.call(n,t[i],i,t);return r},h.every=function(t,e,n){for(var r=0,i=t.length;i>r;++r)if(!e.call(n,t[r],r,t))return!1;return!0},h.some=function(t,e,n){for(var r=0,i=t.length;i>r;++r)if(e.call(n,t[r],r,t))return!0;return!1},h.filter=function(t,e,n){for(var r=[],i=0,o=t.length;o>i;++i)e.call(n,t[i],i,t)&&r.push(t[i]);return r},h.reject=function(t,e,n){for(var r=[],i=0,o=t.length;o>i;++i)e.call(n,t[i],i,t)||r.push(t[i]);return r},h.reduce=function(t,e,n,r){for(var i=arguments.length,o=i>=3?n:t[0],a=t.length,s=i>=3?0:1;a>s;++s)o=e.call(r,o,t[s],s,t);return o},h.reduceRight=function(t,e,n,r){for(var i=arguments.length,o=t.length-1,a=i>=3?n:t[o],s=i>=3?o:o-1;s>=0;--s)a=e.call(r,a,t[s],s,t);return a},h.find=function(t,e,r){for(var i=0,o=t.length;o>i;++i)if(e.call(r,t[i],i,t))return t[i];return n},h.partition=function(t,e){for(var n=[],r=[],i=0,o=t.length;o>i;++i)e.call(null,t[i],i,t)?n.push(t[i]):r.push(t[i]);return[n,r]},h.memoize=function(t,e){var n=function(r){var i=n.cache,o=e?e.apply(this,arguments):r;return h.has(i,o)||(i[o]=t.apply(this,arguments)),i[o]};return n.cache={},n},h.debounce=function(t,e,n){var r;return function(){var i=this,o=arguments,a=function(){r=null,n||t.apply(i,o)},s=n&&!r;r&&(clearTimeout(r),r=null),r=setTimeout(a,e),s&&t.apply(i,o)}},h.now=Date.now||function(){return(new Date).getTime()},h.indexBy=l(function(t,e,n){t[n]=e}),h.groupBy=l(function(t,e,n){(t[n]=t[n]||[]).push(e)}),h.countBy=l(function(t,e,n){t[n]=(t[n]||0)+1}),h}();!function(){var t=Object.prototype.toString;i.noop=function(){},i.identity=function(t){return t},i.isUndefined=function(t){return"undefined"==typeof t},i.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},i.isElement=function(t){return!(!t||1!==t.nodeType)},i.clone=function(t){for(var e=[],n=0,r=t.length;r>n;++n)e[n]=t[n];return e},i.forEach=function(t,e,n){for(var r=0,i=t.length;i>r;++r)e.call(n,t[r],r,t)},i.extend=function(t,e){for(var n in e)i.has(e,n)&&(t[n]=e[n]);return t},i.forEach(["String","Function","Number","Date","Array"],function(e){i["is"+e]=function(n){return t.call(n)==="[object "+e+"]"}}),Array.isArray&&(i.isArray=Array.isArray)}();var o={toJson:function(t){if(!JSON||!JSON.stringify)throw new Error("JSON.stringify is not available in your browser");return JSON.stringify(t)},fromJson:function(t){if(!JSON||!JSON.parse)throw new Error("JSON.parse is not available in your browser");return JSON.parse(t)}},a=function(){var t="key_",e=function(e){return t+e},n=function(){return this instanceof n?void(this.$o={}):new n};return n.prototype={clear:function(){this.$o={}},put:function(t,n){return this.$o[e(t)]=n,this},get:function(t){return this.$o[e(t)]},remove:function(t){return delete this.$o[e(t)],this},contains:function(t){return i.has(this.$o,e(t))}},n}(),s=function(){var t=e.documentMode,n=new a,r={input:"input"},i={hasEvent:function(i){if("input"===i&&11>t)return!1;if(!n.contains(i)){var o=e.createElement(r[i]||"div"),a="on"+i in o;n.put(i,!!a),o=null}return n.get(i)}};return i}(),u=function(){var t=new a,e=function(t){for(var e=[],n=t.split("."),r=/(.+?)?(\[(\d+)\])/,i=/(.+?)?(\['(.+)'\])/,o=/(.+?)?(\["(.+)"\])/,a=function(t,e,n,r){var i=e?e+".":"";return i+r},s=0,u=n.length;u>s;++s){var l=n[s].replace(r,a).replace(i,a).replace(o,a),h=l.indexOf("(");h>0&&(l=l.slice(0,h)),e[s]=l}return e.join(".")},r=function(t){return e(t).split(".")},o=function(t){if(null==t)return{};if(!i.isObject(t))throw new Error('Cannot assign to ready property "'+t+'"');return t},s=function(t,e){for(var r=t.length,o=e,a=0;r>a;++a){if(null==o||!i.isObject(o))return n;o=i.result(o,t[a])}return o},u=function(t,e,n){for(var r=t.length-1,a=e,s=a,u=0;r>u;++u)s=i.result(a,t[u]),s=a[t[u]]=o(s);return s[i.last(t)]=n,n},l=function(e){if(!t.contains(e)){var n=r(e),i=function(t){return s(n,t)};i.assign=function(t,e){return u(n,t,e)},t.put(e,i)}return t.get(e)};return l.$clear=function(){return t.clear(),l},l}(),l=function(t){var n=e.createElement("div");return n.appendChild(e.createTextNode(t)),n.innerHTML},h="waffle-",c="waffle-grid",f=h+"sortable",d=f+"-asc",v=f+"-desc",p=h+"draggable",g=p+"-drag",b=p+"-over",$=h+"fixedheader",y=h+"selectable",m=h+"selected",x=h+"checkbox",C="data-waffle-",w=C+"id",E=C+"sortable",N=C+"order",k=C+"idx",S="+",A="-",D="tbody",O="thead",T="tfoot",z="table",F={msie:function(){return e.documentMode},endWith:function(t,e){return!!t&&t.slice(t.length-e.length)===e},isPx:function(t){return F.endWith(t,"px")},isPercentage:function(t){return F.endWith(t,"%")},fromPercentage:function(t){return i.isString(t)?Number(t.replace("%","")):t},toPx:function(t){return i.isNumber(t)?t+"px":t},fromPx:function(t){return i.isString(t)?Number(t.replace("px","")):t},capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},resultWith:function(t,e,n){return i.isFunction(t)?t.apply(e,n):t},split:function(t,e){for(var n=e||20,r=[],i=[],o=0,a=t.length;a>o;++o)i.push(t[o]),i.length===n&&(r.push(i),i=[]);return i.length>0&&r.push(i),r},parse:function(t){try{return o.fromJson(t)}catch(e){if("false"===t)return!1;if("true"===t)return!0;var n=Number(t);return i.isNaN(n)?t:n}},destroy:function(t){for(var e in t)i.has(t,e)&&(t[e]=null)},toSpinalCase:function(t){for(var e="",n=0,r=t.length;r>n;++n){var i=t.charAt(n);e+=i.toLowerCase()===i?i:"-"+i.toLowerCase()}return e},asyncTask:function(t,e,n,r){var i=0,o=function(){if(t.length>0){var a=t.shift();n(a,i),i+=a.length,t.length>0?setTimeout(o,e):(r(),o=null)}};setTimeout(o)}},B=function(){var t=function(){var t=e.createElement("div");t.style.width="100px",t.style.height="100px",t.style.overflow="scroll",t.style.position="absolute",t.style.top="-9999px",e.body.appendChild(t);var n=t.offsetWidth-t.clientWidth;return e.body.removeChild(t),n},n=function(){return"body"},r={create:function(t){return e.createElement(t)},byId:function(t){var n=e.getElementById(t);return n?[n]:[]},byTagName:function(t,n){return(n||e).getElementsByTagName(t)},createFragment:function(){return e.createDocumentFragment()},findParent:function(t,e){for(;t&&t.tagName!==e;)t=t.parentNode;return t},scrollbarWidth:i.memoize(t,n)};return i.forEach(["tr","td","th",D,O,T,"input","select","option","span"],function(t){r[t]=function(){return this.create(t)}}),i.forEach(["text","checkbox","number","email","url","date","time","datetime"],function(t){var e="input"+F.capitalize(t);r[e]=function(){var e=this.input();return e.setAttribute("type",t),e}}),r}(),j=function(){var t=function(t,e,n){return t.replaceChild(n,e)},e=function(t,e){t.nodeValue!==e.nodeValue&&(t.nodeValue=e.nodeValue)},n=function(t,e){for(;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)},r=function(t,e){o.mergeAttributes(t,e);var r=t.childNodes,i=e.childNodes;if(r.length!==i.length)n(t,e);else for(var a=0,s=r.length;s>a;++a)o.mergeNodes(t,r[a],i[a])},o={mergeNodes:function(n,i,o){var a=i.nodeType,s=o.nodeType,u=i.tagName,l=o.tagName,h=i;return a!==s||u!==l?(t(n,i,o),h=o):3===a?e(i,o):r(i,o),h},mergeAttributes:function(t,e){var n=i.indexBy(t.attributes,"name"),r=i.indexBy(e.attributes,"name");i.forEach(i.keys(r),function(e){var i=n[e]||null,o=i?i.value:null,a=r[e].value;o!==a&&t.setAttribute(e,a),i&&delete n[e]}),i.forEach(i.keys(n),function(e){t.removeAttribute(e)})}};return o}(),R=function(){var t=i.noop,e=function(t,e,n){this.type=t,this.bubbles=!1,this.cancelable=!1,this.details=n,this.timeStamp=i.now(),this.target=e,this.currentTarget=e,this.srcElement=e};e.prototype={preventDefault:t,stopPropagation:t,stopImmediatePropagation:t};var n=function(t){return t.toLowerCase()},r=function(){this.$events={}};return r.prototype={addEventListener:function(t,e){var r=n(t),i=this.$events,o=i[r]=i[r]||[];o.push(e)},removeEventListener:function(t,e){var r=n(t),o=this.$events[r];o&&o.length&&(this.$events[r]=i.reject(o,function(t){return t===e}))},dispatchEvent:function(t,r,o){r=n(r);var a=this.$events[r];if(a&&a.length)for(var s=new e(r,t,i.isFunction(o)?o.call(t):o),u=0,l=a.length;l>u;++u)try{a[u].call(t,s)}catch(h){}},clear:function(){this.$events={}}},r}(),P=function(){var t=function(t){return t&&t.length>0},e=function(){var e=this.$$changes,n=this.$$observers;if(t(e)&&t(n)){var r=e.splice(0,e.length);i.forEach(n,function(t){t.callback.call(t.ctx,r)})}},n={observe:function(t,e){return this.$$observers=this.$$observers||[],this.$$observers.push({ctx:e||null,callback:t}),this},unobserve:function(e,n){if(t(this.$$observers))if(0===arguments.length)this.$$observers=[];else{var r=n||null;this.$$observers=i.reject(this.$$observers,function(t){return t.ctx===r&&e===t.callback})}return this},trigger:function(t){return i.isArray(t)||(t=[t]),this.$$changes=this.$$changes||[],this.$$changes.push.apply(this.$$changes,t),setTimeout(i.bind(e,this)),this},pendingChanges:function(){return this.$$changes||[]},clearChanges:function(){return this.$$changes&&this.$$changes.splice(0,this.$$changes.length),this}};return n}(),W=function(){var t=Array.prototype,e=function(){try{var e={};return e[0]=1,!!t.toString.call(e)}catch(n){return!1}}(),r=function(n){return function(){var r=e?this:i.toArray(this);return t[n].apply(r,arguments)}},o=function(t,e,n){return r(t).apply(e,n)},s=function(t,e){var n=e||{};this.$$map=new a,this.$$model=n.model||Object,this.$$key=n.key||"id",i.isFunction(this.$$key)||(this.$$key=u(this.$$key)),this.length=0,t&&t.length&&this.push.apply(this,t)},l=function(t){return parseInt(Number(t)||0,10)},h="splice",c="update",f=function(t,e,n,r,i){return{type:t,removed:e,index:n,addedCount:r,object:i}},d=function(t,e){delete t[e]},v=function(t,e){t.$$map.remove(e)},p=function(t,e){var n=t.$$key(e),r=t.$$map.get(n),i=r?r.idx:null;null!=i&&(d(t,i),v(t,n))},g=function(t,e){if(!i.isObject(e))throw new Error("Waffle collections are not array, only object are allowed");var n;n=e instanceof t.$$model?e:new t.$$model(e);var r=t.$$key(n);if(null==r)throw new Error("Collection elements must have an id, you probably missed to specify the id key on initialization ?");return n},b=function(t,e,n,r){if(t[n]=e,null!=e){var i=arguments.length,o=3===i?t.$$key(e):r,a=t.$$map.get(o)||{};a.idx=n,t.$$map.put(o,a)}},$=function(t,e){var n=t.indexOf(e);return t[n]=e,f(c,[],n,0,t)},y=function(t,e,n){var r=t.at(n),i=t.at(e);b(t,i,n),b(t,r,e)},m=function(t,e,n){for(var r=Math.abs(n),i=t.length-1;i>=e;--i)y(t,i,i+r);t.length+=r},x=function(t,e,n){for(var r=Math.abs(n),i=t.length,o=i-r,a=e+r,s=[],u=a;i>u;++u)y(t,u,u-r);for(var l=o;i>l;++l){var h=t.at(l);s.unshift(h),p(t,h)}return t.length=o,s},C=function(t,e){for(var n,r=t.$$sortFn,o=t.length,a=e.length,s=o+a,u=[],l=o-1,c=a-1,d=s-1;d>=0;--d)if(0>l||r(t[l],e[c])<0){if(b(t,e[c--],d),n=i.first(u),n&&n.index===d+1?(n.index=d,n.addedCount++):(n=f(h,[],d,1,t),u.unshift(n)),0>c)break}else b(t,t[l--],d);return t.length=s,u};return s.prototype={options:function(){return{model:this.$$model,key:this.$$key}},at:function(t){return this[t]},byKey:function(t){var e=this.indexOf(t);return e>=0?this.at(e):n},ctx:function(t){var e=i.isObject(t)?this.$$key(t):t;return this.$$map.contains(e)?this.$$map.get(e):null},indexOf:function(t){var e=this.ctx(t);return e?e.idx:-1},contains:function(t){return this.indexOf(t)>=0},findIndex:function(t,e){for(var n=0,r=this.length;r>n;++n)if(t.call(e,this.at(n),n,this))return n;return-1},add:function(t,e){var n=null==e?this.length:e,r=[n,0].concat(t);return this.splice.apply(this,r),this.length},remove:function(t,e){if(i.isNumber(t))return this.splice.call(this,t,e||this.length);if(i.isArray(t)){var n=this.$$key,r=i.indexBy(t,n);return this.remove(function(t){return!!r[n(t)]})}for(var o=t,a=e,s=0,u=null,l=[],c=[],p=0,g=this.length;g>p;++p){var $=this.at(p),y=this.$$key($);o.call(a,$,p)?(d(this,p),v(this,y),u===p-1?i.last(l).removed.push($):l.push(f(h,[$],p,0,this)),c.push($),u=p):(s!==p&&(d(this,p),v(this,y),b(this,$,s,y)),s++)}return this.length-=c.length,l.length>0&&this.trigger(l),c},triggerUpdate:function(t){return this.trigger([f(c,[],t,0,this)]),this},push:function(){return this.add.call(this,i.toArray(arguments))},unshift:function(){return this.add.call(this,i.toArray(arguments),0)},pop:function(){return this.remove(this.length-1,1)[0]},shift:function(){return this.remove(0,1)[0]},toggle:function(t){var e=this.indexOf(t);return e>=0?this.remove(e,1):this.push(t)},clear:function(){if(this.length>0){for(var t=[],e=0,n=this.length;n>e;++e)t[e]=this.at(e),d(this,e);this.$$map.clear(),this.length=0,this.trigger(f(h,t,0,0,this))}return this},reset:function(t){var e=this.length,n=t.length,r=this.$$sortFn;r&&t.sort(r),this.$$map.clear();for(var i=[],o=t.length,a=0;n>a;++a)e>a&&i.push(this.at(a)),b(this,g(this,t[a]),a);for(;e>a;++a)i.push(this.at(a)),d(this,a);return this.length=n,this.trigger([f(h,i,0,o,this)]),this},isEmpty:function(){return 0===this.length},concat:function(){var e=t.concat.apply(this.toArray(),arguments);return new s(e,this.options())},slice:function(){var t=o("slice",this,arguments);return new s(t,this.options())},splice:function(t,e){var n=this.$$sortFn,r=this.length,o=i.rest(arguments,2),a=function(t){return g(this,t)},s=i.map(o,a,this),u=l(t);u=u>=0?Math.min(r,u):Math.max(r+u,0);var c=Math.min(Math.max(l(e)||0,0),r-u),d=[];if(c>0){for(var v=0;c>v;++v)d.push(this[v+u]);x(this,u,c)}var p,y=i.groupBy(s,this.contains,this),w=y[!0]||[],E=y[!1]||[],N=E.length,k=w.length;if(N>0)if(n)E.sort(n),p=C(this,E);else{m(this,u,N);for(var S=0;N>S;++S)b(this,E[S],u+S);p=[f(h,d,u,N,this)]}else p=[];if(d.length>0){var A=i.find(p,function(t){return t.index===u});A?A.removed=d:p.unshift(f(h,d,u,0,this))}var D=[];if(k>0){n&&w.sort(n);for(var O=0;k>O;++O)D.push($(this,w[O]))}var T=p.concat(D);return T.length>0&&this.trigger(T),d},reverse:function(){if(this.$$sortFn)return this;for(var t=this.length,e=Math.floor(t/2),n=[],r=[],i=0,o=t-1;e>i;++i,--o)y(this,i,o),n.push(f(c,[],i,0,this)),r.unshift(f(c,[],o,0,this));var a=n.concat(r);return a.length&&this.trigger(a),this},split:function(t){return F.split(this,t)},toJSON:function(){return JSON.stringify(this.toArray())},sort:function(t){return this.$$sortFn=t,this.reset(this.toArray()).clearChanges()},pluck:function(t){var e=u(t);return this.map(function(t){return e(t)})}},s.prototype.lastIndexOf=s.prototype.indexOf,i.extend(s.prototype,P),i.forEach(["size","first","last","initial","rest","partition","forEach","map","every","some","reduce","reduceRight","filter","reject","find","toArray"],function(t){i[t]&&(s.prototype[t]=function(){var e=[this].concat(i.toArray(arguments));return i[t].apply(i,e)})}),i.forEach(["countBy","groupBy","indexBy"],function(t){s.prototype[t]=function(e,n){if(i.isString(e)){var r=u(e);e=function(t){return r(t)}}return i[t].call(i,this,e,n)}}),i.forEach(["toString","toLocaleString","join"],function(t){s.prototype[t]=r(t)}),s}(),I=function(){var t=function(t){return(null==t?"":t).toString()},e={$identity:i.identity,$empty:function(){return""},$lowercase:function(e){return t(e).toLowerCase()},$uppercase:function(e){return t(e).toUpperCase()},$capitalize:function(e){return F.capitalize(t(e))},$get:function(t){return e[t]}};return e}(),L={$string:function(t,e){var n=null==t?"":String(t),r=null==e?"":String(e);return n.localeCompare(r)},$number:function(t,e){var n=null==t?0:Number(t),r=null==e?0:Number(e);return n-r},$boolean:function(t,e){var n="false"===t?0:Boolean(t)?1:0,r="false"===e?0:Boolean(e)?1:0;return n-r},$date:function(t,e){var n=i.isDate(t)?t.getTime():new Date(null==t?0:t).getTime(),r=i.isDate(e)?e.getTime():new Date(null==e?0:e).getTime();return n-r},$auto:function(t,e){if(t===e||null==t&&null==e)return 0;var n=i.find(["Number","Boolean","Date","String"],function(n){var r=i["is"+n];return r(t)||r(e)});return n?L["$"+n.toLowerCase()](t,e):e>t?-1:1},$get:function(t){return L[t]}},U=function(t){return i.isArray(t)||(t=[t]),function(e,n){if(e===n||null==e&&null==n)return 0;for(var r=0,i=t.length;i>r;++r){var o=t[r],a=o.parser(e),s=o.parser(n),u=o.fn.call(L,a,s);if(u)return o.desc?-1*u:u}return 0}},H=function(){var t=function(t){return null==t?"":t.toString()},e=function(e,n,r){var i=t(e),o=t(n);return r(i,o)},n=function(t,e){return t.toLowerCase().indexOf(e.toLowerCase())>=0},r=function(t,r){return e(t,r,n)},o=function(t){var e=function(n){return i.some(i.keys(n),function(o){var a=n[o];return i.isObject(a)?e(a):r(n[o],t)})};return e},a=function(t){var e=i.map(i.keys(t),function(e){return function(n){return r(u(e)(n),t[e])}});return function(t){return i.every(e,function(e){return e(t)})}};return{$create:function(t){if(i.isFunction(t))return t;var e=i.isObject(t)?a:o,n=e(t);return n.$predicate=t,n}}}(),M=function(){var t={enable:!0,type:"text",css:null},e={".":"-","(":"",")":"","[":"-","]":"-","'":"",'"':""},n=i.isUndefined,r="$identity",o="$auto",a=F.resultWith,s=F.fromPx,h=F.toPx,c=function(t,e,n){return i.isString(t)&&(t=e.$get(t)),i.isFunction(t)||(t=e.$get(n)),t},g=function(a){i.isString(a)&&(a={id:a});var s=a.escape,h=a.sortable;this.id=a.id,this.title=a.title||"",this.field=a.field||this.id,this.css=a.css||"",this.escape=n(s)?!0:!!s,this.width=a.width,this.sortable=n(h)?!0:!!h,this.draggable=!!a.draggable,this.asc=null;var f=a.editable===!0?{}:a.editable;if(f&&(f=i.defaults(f,t)),this.editable=f,!this.css)for(var d=0,v=this.id.length;v>d;++d){var p=this.id.charAt(d),g=e[p];this.css+=null!=g?g:p}s&&(this.title=l(this.title));var b=a.renderer||r,$=i.isArray(b)?b:[b];this.$renderer=i.map($,function(t){return c(t,I,r)}),this.$comparator=c(a.comparator,L,o),this.$parser=u(this.field)};return g.prototype={cssClasses:function(t,e,n){var r=n?[n]:[],o=a(this.css,this,r);i.isArray(o)&&(o=o.join(" "));var s=[o];this.sortable&&s.push(f),this.draggable&&s.push(p);var u=this.asc;return null!=u&&s.push(u?d:v),s.join(" ")},attributes:function(t,e){var n={};if(n[w]=this.id,e){if(this.sortable){n[E]=!0;var r=this.asc;null!=r&&(n[N]=r?S:A)}this.draggable&&(n.draggable=!0)}return n},styles:function(){var t={},e=h(this.computedWidth);return e&&(t.width=e,t.maxWidth=e,t.minWidth=e),t},updateWidth:function(t){return this.width=s(t),this},isEditable:function(t){return this.editable&&this.editable.enable?t?a(this.editable.enable,this,[t]):!0:!1},render:function(t){var e=this.field,n=this.value(t),r=i.reduce(this.$renderer,function(n,r){return r.call(I,n,t,e)},n);return null==r?"":this.escape?l(r):r},value:function(t,e){var n=this.$parser;return 2===arguments.length?(n.assign(t,e),this):null==t?"":n(t)}},g}(),J=function(){var t=function(t,n,r,i){var o=t.length-1;if(0>o||0>n||r>=n)return r;for(var a=Math.min(n,o),s=n;a>=0&&s>=n;){if(s=e.getDataIndex(t[a]),i(s,n))return a;a--}return r},e={getDataIndex:function(t){return Number(t.getAttribute(k))},getRowIndexForDataIndex:function(e,n){return t(e,n,-1,function(t,e){return t===e})},getPreviousRowIndexForDataIndex:function(e,n){return t(e,n-1,-1,function(t,e){return e>=t})},getCheckbox:function(t){return t.childNodes[0].childNodes[0]}};return e}(),V=function(){var t="THEAD",e="TFOOT",n="TBODY",o="TH",a="TR",s="INPUT",u=function(t){return t.tagName===s&&"checkbox"===t.getAttribute("type")},l=function(t){return!!t.getAttribute("draggable")},h=function(t,e){var n=B.findParent(t,e.tagName);return n===e},c={number:function(t){return Number(t)},checkbox:function(t){return!!t}},f={checkbox:"checked"},d=function(t,e){var n=t.target,r=B.findParent(t.target,o);if(n.tagName!==e)if(this.isSelectable()&&u(n))n.checked?this.select():this.deselect();else if(r&&r.getAttribute(E)){var a,s=r.getAttribute(w),l=r.getAttribute(N)||A,h=l===S?A:S,c=h+s;if(t.shiftKey){var f=l+s;a=i.reject(this.$sortBy,function(t){return t===f})}else a=[];a.push(c),this.sortBy(a)}},v={onClickThead:function(e){return d.call(this,e,t)},onClickTfoot:function(t){return d.call(this,t,e)},onClickTbody:function(t){if(this.isSelectable()&&t.target.tagName!==n){var e=B.findParent(t.target,a),r=e.getAttribute(k),i=this.$data.at(r);if(this.isSelectable(i)){var o=this.$selection;if(this.options.selection.multi)if(t.shiftKey){for(var s=parseFloat(r),u=parseFloat(this.$$selectAnchor),l=Math.min(s,u),h=Math.max(s,u),c=[],f=l;h>=f;++f){var d=this.$data.at(f);!o.contains(d)&&this.isSelectable(d)&&c.push(d)}c.length>0&&o.push.apply(o,c)}else o.toggle(i),this.$$selectAnchor=r;else{var v=o.indexOf(i);v>=0?o.remove(v,1):o.reset([i])}}}},onInputTbody:function(t){var e=t.target,n=e.getAttribute(w),r=n?this.$columns.byKey(n):null;if(r&&r.isEditable()){var o=B.findParent(e,"TR");if(o){var a=r.editable.type,s=c[a]||i.identity,u=f[a]||"value",l=Number(o.getAttribute(k)),h=this.$data,d=h.at(l),v=r.value(d),p=s(e[u]);v!==p&&(r.value(d,p),this.dispatchEvent("datachanged",{index:l,object:d,field:n,oldValue:v,newValue:p}),h.triggerUpdate(l))}}},onDragStart:function(t){var e=t.target,n=t.originalEvent||t,i=n.dataTransfer;l(e)&&(r(e).addClass(g),i.effectAllowed="move",i.clearData(),i.setData("Text",e.getAttribute(w)))},onDragEnd:function(t){var e=t.target,n=this.$table[0];r(B.byTagName("th",n)).removeClass(b),l(e)&&h(e,n)&&r(t.target).removeClass(g)},onDragOver:function(t){var e=t.target;if(l(e)&&h(e,this.$table[0])){var n=t.originalEvent||t,r=n.dataTransfer;return r.dropEffect="move",t.preventDefault(),!1}},onDragEnter:function(t){var e=t.target;return l(e)&&h(e,this.$table[0])?(r(e).addClass(b),t.preventDefault(),!1):void 0},onDragLeave:function(t){var e=t.target;return l(e)&&h(e,this.$table[0])?(r(e).removeClass(b),t.preventDefault(),!1):void 0},onDragDrop:function(t){var e=t.target;if(l(e)&&h(e,this.$table[0])){var n=t.originalEvent||t,i=n.dataTransfer,o=i.getData("Text"),a=e.getAttribute(w);if(o!==a){var s=this.$columns,u=s.indexOf(o),c=s.indexOf(a);s.add(s.remove(u,1),c),r(e).removeClass(b)}return t.preventDefault(),!1}},onSelectStart:function(t){var e=t.target;return l(e)?(t.preventDefault(),e.dragDrop(),!1):void 0}};return v}(),q=function(){var e=function(t,e,n,r){var o=t["$"+e];o&&!t.$$events[r]&&(t.$$events[r]=i.bind(V[r],t),o.on(n,t.$$events[r]))},n=function(t,e,n,r){var i=t["$"+e];i&&t.$$events[r]&&(i.off(n,t.$$events[r]),t.$$events[r]=null)},o=function(){var t=s.hasEvent("input")?"input":"keyup";return t+=" change"},a="click",u={bindResize:function(e){if(!e.$$events.onResize){var n=i.bind(e.resize,e);e.$$events.onResize=i.debounce(n,100),e.$window=r(t),e.$window.on("resize",e.$$events.onResize)}},bindEdition:function(t){e(t,D,o(),"onInputTbody")},unbindEdition:function(t){n(t,D,o(),"onInputTbody")},bindSelection:function(t){e(t,O,a,"onClickThead"),e(t,T,a,"onClickTfoot"),e(t,D,a,"onClickTbody")},bindSort:function(t){e(t,O,a,"onClickThead"),e(t,T,a,"onClickTfoot")},bindDragDrop:function(t){e(t,z,"dragstart","onDragStart"),e(t,z,"dragover","onDragOver"),e(t,z,"dragend","onDragEnd"),e(t,z,"dragleave","onDragLeave"),e(t,z,"dragenter","onDragEnter"),e(t,z,"drop","onDragDrop"),F.msie()<=9&&e(t,z,"selectstart","onSelectStart")}};return u}(),K=function(){var t="px",e="percent",n="auto",o={};o[t]=function(t){return F.fromPx(t.computedWidth)},o[e]=function(t,e){return F.fromPercentage(t.computedWidth)*e/100},o[n]=function(t,e,n){return e/n};var a={checkbox:function(t){return!!t}},s={computeWidth:function(r,a){var s=r,u=0,l=a.groupBy(function(r){var o=r.computedWidth=i.result(r,"width");return i.isNumber(o)||F.isPx(o)?t:F.isPercentage(o)?e:n});i.forEach([t,e,n],function(t){var e=l[t];if(e){var n=s,r=e.length;i.forEach(e,function(e){var i=o[t](e,n,r);e.computedWidth=i,s-=i,u++})}})},theadRow:function(t){var e=B.tr();return t.hasCheckbox()&&e.appendChild(s.theadCheckboxCell(t)),t.$columns.forEach(function(n,r){e.appendChild(s.theadCell(t,n,r))}),e},theadCell:function(t,e,n){return r(B.th()).addClass(e.cssClasses(n,!0)).css(e.styles(n,!0)).attr(e.attributes(n,!0)).html(e.title)[0]},theadCheckboxCell:function(t){var e=t.$selection.size(),n=r(B.span()).attr("title",e).html(e),i=t.isSelected(),o=r(B.inputCheckbox()).prop("checked",i).prop("indeterminate",!i&&e>0);return r(B.th()).addClass(x).append(n[0]).append(o[0])[0]},tfootRow:function(t){var e=B.tr();return t.hasCheckbox()&&e.appendChild(s.tfootCheckboxCell(t)),t.$columns.forEach(function(n,r){e.appendChild(s.tfootCell(t,n,r))}),e},tfootCell:function(t,e,n){return s.theadCell(t,e,n)},tfootCheckboxCell:function(t){var e=s.theadCheckboxCell(t);return e.appendChild(e.childNodes[0]),e},tbodyRows:function(t,e,n){for(var r=B.createFragment(),i=0,o=e.length;o>i;++i)r.appendChild(s.tbodyRow(t,e[i],n+i));return r},tbodyRow:function(t,e,n){var i=r(B.tr());return i.attr(k,n),i.attr(w,t.$data.$$key(e)),t.isSelectable()&&(t.isSelectable(e)&&i.addClass(y),t.$selection.contains(e)&&i.addClass(m),t.hasCheckbox()&&i[0].appendChild(s.tbodyCheckboxCell(t,e))),t.$columns.forEach(function(n,r){i[0].appendChild(s.tbodyCell(t,e,n,r))}),i[0]},tbodyCell:function(t,e,n,i){var o=r(B.td()).addClass(n.cssClasses(i,!1,e)).css(n.styles(i,!1)).attr(n.attributes(i,!1)),a=n.isEditable(e);return a?o.append(s.tbodyControl(n,e)):o.html(n.render(e)),o[0]},tbodyCheckboxCell:function(t,e){var n=r(B.td()).addClass(x);if(t.isSelectable(e)){var i=r(B.inputCheckbox()).prop("checked",t.isSelected(e));n.append(i[0])}return n[0]},tbodyControl:function(t,e){var n,r=t.editable;"select"===r.type?(n=B.select(),r.options&&i.forEach(r.options,function(t){var e=B.option();e.innerHTML=null!=t.label?t.label:"",null!=t.value&&(e.value=t.value),n.appendChild(e)})):(n=B.input(),n.setAttribute("type",r.type)),n.setAttribute(w,t.id);var o="checkbox"===r.type?"checked":"value",s=a[r.type]||i.identity;return n[o]=s(t.value(e)),r.css&&(n.className=r.css),n}};return s}(),_=function(){var t="px",e="percent",n="auto",r={};r[t]=function(t){return F.fromPx(t)},r[e]=function(t,e){return F.fromPercentage(t)*e/100},r[n]=function(t,e,n){return e/n};var o={resize:function(t){o.applySize(t)},applySize:function(t){var e=t.options.size,r=i.result(e,"width"),a=i.result(e,"height"),s=r&&r!==n,u=a&&a!==n;if(s){var l=F.toPx(r);t.$table.css({width:l,maxWidth:l,minWidth:l})}if(u){var h=F.toPx(a);t.$tbody.css({maxHeight:h})}var c=s?F.fromPx(r):null;c||(c=t.$table[0].offsetWidth),c-=B.scrollbarWidth(),t.hasCheckbox()&&(c-=30);var f=t.$columns,d=o.computeWidth(c,f);if(d.length>0)for(var v=i.indexBy(f.pendingChanges(),function(t){return t.type+"_"+t.index}),p=0,g=d.length;g>p;++p){var b=f.indexOf(d[p]);i.has(v,"update_"+b)||f.triggerUpdate(b)}return this},computeWidth:function(o,s){var u=o,l=0,h=new a,c=s.groupBy(function(r){var o=i.result(r,"width");return h.put(r.id,o),i.isNumber(o)||F.isPx(o)?t:F.isPercentage(o)?e:n}),f=[];return i.forEach([t,e,n],function(t){var e=c[t];if(e){var n=u,o=e.length;i.forEach(e,function(e){var i=r[t](h.get(e.id),n,o);i!==e.computedWidth&&(e.computedWidth=i,f.push(e)),u-=i,l++})}}),f}};return o}(),G=function(){var t=J.getDataIndex,e=J.getPreviousRowIndexForDataIndex,n=J.getRowIndexForDataIndex,o={on:function(t){return i.forEach(t,function(t){var e="on"+F.capitalize(t.type);o[e].call(this,t)},this),this},onSplice:function(n){var o,a,s,u=this.$tbody,l=u[0],h=l.childNodes,c=n.index,f=n.addedCount,d=n.object,v=n.removed,p=e(h,c)+1,g=v.length;if(g>0){var b=0===c&&d.length-f===0;if(b)o=i.toArray(h),u.empty();else{o=[];for(var $=h[p],y=0;g>y&&$;++y){var m=c+y,x=t($);x===m&&(o.push(l.removeChild($)),$=h[p])}}var C=this.$selection;C&&C.length>0&&C.remove(v)}if(f>0){a=[],s=[];for(var w=B.createFragment(),E=this.$filter||i.constant(!0),N=0;f>N;++N){var S=N+c,A=d.at(S),D=d.ctx(A);if(s.push(A),D.visible=E(A),D.visible){var O=K.tbodyRow(this,A,S);a.push(O),w.appendChild(O)}}a.length>0&&(p>0?r(h[p-1]).after(w):u.prepend(w))}if(o||a){for(var T=f-g,z=c+i.size(a),F=h.length;F>z;++z){var j=h[z],R=t(j);j.setAttribute(k,R+T)}this.dispatchEvent("dataspliced",{added:s||[],addedNodes:a||[],removedNodes:o||[],removed:v,index:c,nodeIndex:p})}return this},onUpdate:function(t){var e=t.index,r=this.$data.at(e),i=this.$tbody[0],o=i.childNodes,a=n(o,e);if(a>=0){var s=o[a],u=K.tbodyRow(this,r,e),l=j.mergeNodes(i,s,u);this.dispatchEvent("dataupdated",{index:e,nodeIndex:a,oldNode:s,newNode:l})}return this}};return o}(),Q=function(){var t=function(t){return t.getAttribute(w)},e=function(e,n){for(var r=[],o=e.childNodes,a=0,s=o.length;s>a;++a)for(var u=o[a],l=i.indexBy(u.childNodes,t),h=0,c=n.length;c>h;++h){var f=l[n[h].id];f&&r.push(u.removeChild(f))}return r},n=function(t,e,n){return t.insertBefore(e,t.childNodes[n]||null)},r={tbody:function(t,e,n){return K.tbodyCell(this,this.$data.at(n),t,e)},thead:function(t,e){return K.theadCell(this,t,e)},tfoot:function(t,e){return K.tfootCell(this,t,e)}},o=function(t,e,n){return function(i,o){var a=i.childNodes[n],s=r[t].call(this,e,n,o),u=j.mergeNodes(i,a,s);return{oldNode:a,newNode:u}}},a=function(t,e){e.draggable=!!e.draggable||!!t.isDraggable(),t.isSortable()||(e.sortable=!1)},s={on:function(t){return i.forEach(t,function(t){var e="on"+F.capitalize(t.type);s[e].call(this,t)},this),this},onSplice:function(r){var o,s,u,l,h,c=this.$tbody[0],f=this.hasHeader()?this.$thead[0]:null,d=this.hasFooter()?this.$tfoot[0]:null,v=this.hasCheckbox(),p=r.index,g=r.addedCount,b=r.removed,$=[],y=[],m=[],x=this.$data,C=this.$columns,E=b.length,N=E>0||g>0;N&&this.isResizable()&&this.resize(),E>0&&(y.push.apply(y,e(c,b)),f&&$.push.apply($,e(f,b)),d&&m.push.apply(m,e(d,b)));var k=[],S=[],A=[];if(g>0){for(o=0;g>o;++o){u=p+o;var D=C.at(u);if(a(this,D),f){var O=K.theadCell(this,D,u);l=f.childNodes[0],k.push(n(l,O,v?u+1:u))}if(d){var T=K.tfootCell(this,D,u);l=d.childNodes[0],A.push(n(l,T,v?u+1:u))}}for(s=0,h=c.childNodes.length;h>s;++s){l=c.childNodes[s];var z=i.indexBy(l.childNodes,t),F=l.getAttribute(w),B=x.byKey(F);for(o=0;g>o;++o){u=p+o;var j=C.at(u),R=j.id;z[R]&&l.removeChild(z[R]);var P=K.tbodyCell(this,B,C.at(u),u);S.push(n(l,P,v?u+1:u))}}}if(N){var W=this.isEditable();g>0&&W?q.bindEdition(this):E>0&&!W&&q.unbindEdition(this),this.dispatchEvent("columnsspliced",{index:p,removedNodes:{thead:$,tbody:y,tfoot:m},addedNodes:{thead:k,tbody:S,tfoot:A}})}return this},onUpdate:function(t){var e=t.index,n=this.hasCheckbox()?e+1:e,r=this.$columns.at(e);a(this,r);var s=function(t){
var e=[[],[]],a=this["$"+t];if(a){var s=a[0].childNodes,u=o.call(this,t,r,n),l=function(t,e,n){var r=u.call(this,e,n);return t[0].push(r.oldNode),t[1].push(r.newNode),t};e=i.reduce(s,l,e,this)}return e},u=i.map([O,T,D],s,this);return r.editable?q.bindEdition(this):this.isEditable()||q.unbindEdition(this),this.dispatchEvent("columnsupdated",{index:e,oldNodes:{thead:u[0][0],tfoot:u[1][0],tbody:u[2][0]},newNodes:{thead:u[0][1],tfoot:u[1][1],tbody:u[2][1]}}),this}};return s}(),Y=function(){var t=J.getRowIndexForDataIndex,e=J.getCheckbox,n=function(t,e){t.checked=e},o={on:function(t){return i.forEach(t,function(t){var e="on"+F.capitalize(t.type),n=Y[e];n&&n.call(this,t)},this),this},onSplice:function(i){var o,a,s,u,l=this.$tbody,h=this.$data,c=i.object,f=l[0],d=f.childNodes,v=i.index,p=i.removed,g=i.addedCount,b=p.length;if(b>0)for(var $=0;b>$;++$)o=h.indexOf(p[$]),o>=0&&(s=t(d,o),a=d[s],a&&(r(a).removeClass(m),this.hasCheckbox()&&(u=e(a),u&&n(u,!1))));if(g>0)for(var y=0;g>y;++y)o=h.indexOf(c.at(v+y)),s=t(d,o),a=d[s],a&&(r(a).addClass(m),this.hasCheckbox()&&(u=e(a),u&&n(u,!0)));if(g>0||b>0){var x=g-b;if(x&&this.hasCheckbox()){var C=c.length,w=this.isSelected(),E=C>0&&h.length!==C,N=this.hasHeader()?this.$thead[0]:null,k=this.hasFooter()?this.$tfoot[0]:null;if(N){var S=N.childNodes[0].childNodes[0],A=S.childNodes[0],D=S.childNodes[1];A.innerHTML=A.title=C,D.checked=w,D.indeterminate=E}if(k){var O=k.childNodes[0].childNodes[0],T=O.childNodes[1],z=O.childNodes[0];T.innerHTML=T.title=C,z.checked=w,z.indeterminate=E}}this.dispatchEvent("selectionchanged",function(){return{selection:this.$selection.toArray()}})}return this}};return o}(),X=function(){var t={applyFilter:function(t){var e=null==t?i.constant(!0):t,n=function(t,n,r){var o=this.$tbody[0],a=o.childNodes,s=this.$data.ctx(n),u=i.isUndefined(s.visible)?!0:!!s.visible,l=!!e(n),h=0;if(s.visible=l,u!==l){var c=a[s.idx-t];if(l){var f=K.tbodyRow(this,n,r);o.insertBefore(f,c)}else o.removeChild(c),h++}else l||h++;return t+h},r=this.$data.reduce(n,0,this);this.dispatchEvent("filterupdated",{predicate:t,countVisible:this.$data.size()-r,countFiltered:r})}};return t}(),Z=function(){var t=F.resultWith,e=function(t){var e=t||[];return i.isArray(e)||(e=[e]),i.map(e,function(t){var e=t.charAt(0);return e!==S&&e!==A?S+t:t})},o=function(t){var e="$"+t,n=this.$table;this[e]=r(B.byTagName(t,n[0])),this[e].length||(this[e]=r(B[t]())),n.append(this[e][0])},a=function(t){var e=this.options.events[t];e&&this.addEventListener(t.slice(2),this.options.events[t])},s=function(t,e){if(!(this instanceof s))return new s(t,e);var n=this.$table=r(t),u=n[0],l=this.options=e=e||{},h=s.options;i.forEach(i.keys(h),function(t){var e=l[t],n=h[t];if(i.isUndefined(e)){var r=F.toSpinalCase(t),o=u.getAttribute("data-waffle-"+r)||u.getAttribute("data-"+r)||u.getAttribute(r);o&&(e=l[t]=F.parse(o))}i.isObject(n)&&(i.isObject(e)||i.isUndefined(e))&&(e=l[t]=i.defaults(e||{},n)),i.isUndefined(e)&&(e=l[t]=n)}),l.size={width:l.size.width,height:l.size.height},l.scrollable=l.scrollable||!!l.size.height,this.$data=new W(l.data,{key:l.key,model:l.model});var f=this.isSortable(),d=this.isDraggable();!l.columns||f&&!d||i.forEach(l.columns,function(t){f||(t.sortable=!1),d&&(t.draggable=null==t.draggable?!0:!!t.draggable)}),this.$columns=new W(l.columns,{key:"id",model:M});var v=l.scrollable,p=this.isSelectable(),g=this.isEditable();this.$sortBy=[],n.addClass(c),p&&n.addClass(y),v&&n.addClass($);var b=[D];l.view.thead&&b.unshift(O),l.view.tfoot&&b.push(T),i.forEach(b,o,this),this.$data.observe(G.on,this),this.$columns.observe(Q.on,this),this.$$events={},f&&q.bindSort(this),g&&q.bindEdition(this),p&&(this.$selection=new W([],this.$data.options()),this.$selection.observe(Y.on,this),q.bindSelection(this)),this.$bus=new R,i.forEach(i.keys(l.events),a,this),this.isResizable()&&(this.resize(),q.bindResize(this)),this.renderHeader().renderFooter().sortBy(e.sortBy,!1).renderBody(),this.clearChanges(),d&&q.bindDragDrop(this),this.dispatchEvent("initialized")};s.create=function(t,e){return new s(t,e)},s.prototype={data:function(){return this.$data},columns:function(){return this.$columns},selection:function(){return this.$selection},isEditable:function(){return this.options.editable||this.$columns.some(function(t){return t.isEditable()})},isSortable:function(){return this.options.sortable},isSelectable:function(e){var n=this.options.selection;return n&&n.enable?e?t(n.enable,this,[e]):!0:!1},isResizable:function(){var t=this.options.size;return!!t.height||!!t.width},hasCheckbox:function(){return this.isSelectable()&&this.options.selection.checkbox},hasHeader:function(){return!!this.$thead},hasFooter:function(){return!!this.$tfoot},isSelected:function(t){if(!this.isSelectable())return!1;if(t)return this.$selection.contains(t);var e=this.$selection.length;if(0===e)return!1;var n=this.$data.length;return i.isFunction(this.options.selection.enable)&&(n=this.$data.filter(this.isSelectable,this).length),e>=n},isDraggable:function(){return!!this.options.dnd},isVisible:function(t){var e=this.$data.ctx(t);return e&&e.visible!==!1},visibleData:function(){var t=this.$data,e=this.$filter;return null!=e?t.filter(this.isVisible,this):t.toArray()},render:function(t){return this.renderHeader().renderFooter().renderBody(t).clearChanges()},renderHeader:function(){if(this.hasHeader()){var t=K.theadRow(this);this.$thead.empty().append(t)}return this},renderFooter:function(){if(this.hasFooter()){var t=K.tfootRow(this);this.$tfoot.empty().append(t)}return this},renderBody:function(t){var e=null==t?this.options.async:t,n=this,r=i.once(function(){n.$tbody.empty()}),o=function(t,e){var i=K.tbodyRows(n,t,e);r(),n.$tbody.append(i)},a=function(){n.$data.clearChanges(),n.dispatchEvent("rendered",function(){return{data:this.$data,nodes:i.toArray(this.$tbody[0].childNodes)}}),n=r=o=a=null},s=this.$data;return null!=this.$filter&&(s=this.visibleData()),e?F.asyncTask(F.split(s,200),10,o,a):(o(s,0),a()),this},resize:function(){return _.resize(this),this},select:function(){return this.$selection.length!==this.$data.length&&this.$selection.add(this.$data.filter(this.isSelectable,this)),this},deselect:function(){return this.$selection.isEmpty()||this.$selection.clear(),this},sortBy:function(t,n){var r=e(t);if(this.$sortBy===r||this.$sortBy.join()===r.join())return this;this.$sortBy=r;var o=this.hasHeader(),a=this.hasFooter(),s=o?this.$thead.children().eq(0).children():null,l=a?this.$tfoot.children().eq(0).children():null,h=function(t){t.removeClass(d+" "+v).removeAttr(N)},c=function(t,e,n,r){t.eq(e).addClass(n?d:v).attr(N,r)};s&&h(s),l&&h(l);var f=this.$columns,p=this.hasCheckbox(),g=i.map(this.$sortBy,function(t){var e,n=t.charAt(0),r=t.substr(1),i=n===S,o=f.indexOf(r),a=p?o+1:o;return o>=0?(e=f.at(o),e.asc=i,s&&c(s,a,i,n),l&&c(l,a,i,n)):e={},{parser:e.$parser||u(t),fn:e.$comparator||L.$auto,desc:!i}});return this.$data.sort(U(g)),n!==!1&&this.renderBody(),this.dispatchEvent("sorted")},filter:function(t){var e=null==t||""===t,r=e?n:t,i=this.$filter,o=i?i.$predicate:null,a=null==o||o!==r;return a&&(this.$filter=null==r?n:H.$create(r),X.applyFilter.call(this,this.$filter)),this},removeFilter:function(){return null!=this.$filter&&this.filter(n),this},dispatchEvent:function(t,e){return this.$bus.dispatchEvent(this,t,e),this.$bus.dispatchEvent(this,"updated"),this},addEventListener:function(t,e){return this.$bus.addEventListener(t,e),this},removeEventListener:function(t,e){return this.$bus.removeEventListener(t,e),this},clearChanges:function(){return this.$data.clearChanges(),this.$columns.clearChanges(),this.$selection&&this.$selection.clearChanges(),this},destroy:function(){this.$table.off(),this.$tbody.off(),this.hasHeader()&&this.$thead.off(),this.hasFooter()&&this.$tfoot.off(),this.$$events.onResize&&this.$window&&(this.$window.off("resize",this.$$events.onResize),this.$window=null),this.clearChanges(),this.$data.unobserve(),this.$columns.unobserve(),this.$selection.unobserve(),this.$bus.clear(),this.$$events=null,F.destroy(this)}},s.options={key:"id",data:null,columns:null,sortBy:null,async:!1,scrollable:!1,sortable:!0,editable:!1,dnd:!1,selection:{enable:!0,checkbox:!0,multi:!1},view:{thead:!0,tfoot:!1},size:{width:null,height:null},events:{}};var l=["onInitialized","onUpdated","onRendered","onDataSpliced","onDataChanged","onDataUpdated","onColumnsSpliced","onColumnsUpdated","onSelectionChanged","onFilterUpdated","onSorted"];return i.forEach(l,function(t){s.options.events[t]=null}),s}(),tt={Grid:Z,options:Z.options,create:function(t,e){return Z.create(t,e)},addRenderer:function(t,e){return I[t]=e,tt},addComparator:function(t,e){return L[t]=e,tt}},et="wafflejs";r.fn.waffle=function(t){var e=this,n=[e].concat(i.rest(arguments));return i.isUndefined(t)||i.isObject(t)?this.each(function(){var e=r(this),n=e.data(et);n||(n=tt.create(this,t),e.data(et,n),e.on("waffleDestroyed",function(){var t=r(this);t.data(et).destroy(),t.removeData(et).off()}))}):i.isString(t)&&(e=r.fn.waffle[t].apply(null,n)||e),e},r.fn.waffle.options={},r.event.special.waffleDestroyed={add:function(t){t.handler&&(t.handler=i.bind(t.handler,this))},remove:function(t){t.handler&&t.handler(t)}};var nt=i.filter(i.functions(Z.prototype),function(t){return"$"!==t.charAt(0)});return i.forEach(nt,function(t){r.fn.waffle[t]=function(e){var n=i.rest(arguments),o=[];return e.each(function(){var i=r(this),a=i.data(et);if(a){var s=a[t].apply(a,n),u=s instanceof Z?e:s;u===e?o[0]=u:o.push(u)}}),1===o.length?o[0]:o}}),i.forEach(i.functions(tt),function(t){r.fn.waffle[t]=tt[t]}),r.fn.waffle.options=Z.options,tt})}(window,document,void 0);