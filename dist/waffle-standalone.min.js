!function(t,n,e){!function(n){"function"==typeof define&&define.amd?define(n):"object"==typeof exports?module.exports=n():t.Waffle=n()}(function(){"use strict";var t=function(){var t=function(n){return n instanceof t?n:this instanceof t?(r.isElement(n)&&(n=[n]),r.forEach(n,function(t,n){this[n]=t},this),this.length=n.length,void(this.$$events=[])):new t(n)},n=function(t,n,e,r){r.addEventListener(n,e),t.$$events.push({event:n,callback:e,node:r})},e=function(t,n,e,r){r.removeEventListener(n,e)},i=function(t,n){return r.forEach(t,n,t),t};return t.prototype={children:function(){var n=[];return i(this,function(t){r.forEach(t.childNodes,function(t){1===t.nodeType&&n.push(t)})}),new t(n)},eq:function(n){return new t(this[n])},on:function(t,e){return i(this,function(r){n(this,t,e,r)})},off:function(){for(var t=0,n=this.$$events.length;n>t;++t){var r=this.$$events[t];e(this,r.event,r.callback,r.node)}this.$$events=[]},empty:function(){return i(this,function(t){for(;t.firstChild;)t.removeChild(t.firstChild)})},append:function(t){return i(this,function(n,e,r){var i=e===r.length-1?t:t.cloneNode(!0);n.appendChild(i)})},prepend:function(t){return i(this,function(n,e,r){var i=e===r.length-1?t:t.cloneNode(!0);n.insertBefore(i,n.childNodes[0])})},after:function(t){return i(this,function(n,e,r){var i=e===r.length-1?t:t.cloneNode(!0);n.parentNode.insertBefore(i,n.nextSibling)})},css:function(t,n){var e,o;return r.isObject(t)?(e=t,o=r.keys(e)):(e={},e[t]=n,o=[t]),i(this,function(t){r.forEach(o,function(n){t.style[n]=e[n]})})},addClass:function(t){return i(this,function(n){var e=n.className;n.className=(e?e+" ":"")+t})},removeClass:function(t){var n=t.split(" "),e=r.indexBy(n,function(t){return t});return i(this,function(t){var n=t.className,i=r.filter(n.split(" "),function(t){return!e[t]});t.className=i.join(" ")})},html:function(t){return i(this,function(n){n.innerHTML=t})},attr:function(t,n){var e,o=t;return 2===arguments.length?(o={},o[t]=n,e=[t]):e=r.keys(o),i(this,function(t){r.forEach(e,function(n){t.setAttribute(n,o[n])})})},removeAttr:function(t){return i(this,function(n){n.removeAttribute(t)})},prop:function(t,n){return i(this,function(e){e[t]=n})}},t}(),r=function(){var t=Array.prototype,n=t.slice,r=Object.prototype,i=Object.keys,o=r.hasOwnProperty,s=r.toString,a=Function.prototype.bind,u=function(t){return h.isString(t)?function(n){return n[t]}:t},c=function(t){return function(n,e,r){for(var i={},o=u(e),s=0,a=n.length;a>s;++s){var c=o.call(r,n[s],s,n);t(i,n[s],c)}return i}},h={};return h.isNull=function(t){return null===t},h.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"===s.call(t)},h.bind=function(t,n){return a?t.bind(n):function(){return t.apply(n,arguments)}},h.toArray=function(t){return h.map(t,function(t){return t})},h.once=function(t){var n,e=!1;return function(){return e||(e=!0,n=t.apply(this,arguments),t=null),n}},h.defaults=function(t,n){return h.forEach(h.keys(n),function(e){h.isUndefined(t[e])&&(t[e]=n[e])}),t},h.result=function(t,n){var e=t[n];return h.isFunction(e)?e.call(t):e},h.has=function(t,n){return o.call(t,n)},h.size=function(t){return t.length},h.first=function(t,e){return null==e?t[0]:n.call(t,0,e)},h.last=function(t,e){return null==e?t[t.length-1]:n.call(t,t.length-e,t.length)},h.rest=function(t,e){var r=arguments.length>1?e:1;return n.call(t,r,t.length)},h.initial=function(t,e){var r=t.length,i=arguments.length>1?r-e:r-1;return n.call(t,0,i)},h.indexOf=function(t,n){for(var e=0,r=t.length;r>e;++e)if(t[e]===n)return e;return-1},h.lastIndexOf=function(t,n){for(var e=t.length-1;e>=0;--e)if(t[e]===n)return e;return-1},h.contains=function(t,n){return h.indexOf(t,n)>=0},h.keys=function(t){if(!h.isObject(t))return[];if(i)return i(t);var n=[];for(var e in t)h.has(t,e)&&n.push(e);return n},h.functions=function(t){var n=[];for(var e in t)h.isFunction(t[e])&&n.push(e);return n.sort()},h.map=function(t,n,e){for(var r=[],i=0,o=t.length;o>i;++i)r[i]=n.call(e,t[i],i,t);return r},h.every=function(t,n,e){for(var r=0,i=t.length;i>r;++r)if(!n.call(e,t[r],r,t))return!1;return!0},h.some=function(t,n,e){for(var r=0,i=t.length;i>r;++r)if(n.call(e,t[r],r,t))return!0;return!1},h.filter=function(t,n,e){for(var r=[],i=0,o=t.length;o>i;++i)n.call(e,t[i],i,t)&&r.push(t[i]);return r},h.reject=function(t,n,e){for(var r=[],i=0,o=t.length;o>i;++i)n.call(e,t[i],i,t)||r.push(t[i]);return r},h.reduce=function(t,n,e){for(var r=arguments.length,i=3===r?e:t[0],o=t.length,s=3===r?0:1;o>s;++s)i=n.call(null,i,t[s],s,t);return i},h.reduceRight=function(t,n,e){for(var r=arguments.length,i=t.length-1,o=3===r?e:t[i],s=3===r?i:i-1;s>=0;--s)o=n.call(null,o,t[s],s,t);return o},h.find=function(t,n,r){for(var i=0,o=t.length;o>i;++i)if(n.call(r,t[i],i,t))return t[i];return e},h.partition=function(t,n){for(var e=[],r=[],i=0,o=t.length;o>i;++i)n.call(null,t[i],i,t)?e.push(t[i]):r.push(t[i]);return[e,r]},h.memoize=function(t,n){var e=function(r){var i=e.cache,o=n?n.apply(this,arguments):r;return h.has(i,o)||(i[o]=t.apply(this,arguments)),i[o]};return e.cache={},e},h.now=Date.now||function(){return(new Date).getTime()},h.indexBy=c(function(t,n,e){t[e]=n}),h.groupBy=c(function(t,n,e){(t[e]=t[e]||[]).push(n)}),h.countBy=c(function(t,n,e){t[e]=(t[e]||0)+1}),h}();!function(){var t=Object.prototype.toString;r.noop=function(){},r.identity=function(t){return t},r.isUndefined=function(t){return"undefined"==typeof t},r.isObject=function(t){var n=typeof t;return"function"===n||"object"===n&&!!t},r.isElement=function(t){return!(!t||1!==t.nodeType)},r.clone=function(t){for(var n=[],e=0,r=t.length;r>e;++e)n[e]=t[e];return n},r.forEach=function(t,n,e){for(var r=0,i=t.length;i>r;++r)n.call(e,t[r],r,t)},r.extend=function(t,n){for(var e in n)r.has(n,e)&&(t[e]=n[e]);return t},r.forEach(["String","Function","Number","Date","Array"],function(n){r["is"+n]=function(e){return t.call(e)==="[object "+n+"]"}}),Array.isArray&&(r.isArray=Array.isArray)}();var i=function(t){var n=i.$split(t),o=n.length;return function(t){for(var i=t,s=0;o>s;++s){if(null==i||!r.isObject(i))return e;i=r.result(i,n[s])}return i}};i.$normalize=function(t){for(var n=[],e=t.split("."),r=/(.+?)?(\[(\d+)\])/,i=/(.+?)?(\['(.+)'\])/,o=/(.+?)?(\["(.+)"\])/,s=function(t,n,e,r){var i=n?n+".":"";return i+r},a=0,u=e.length;u>a;++a){var c=e[a].replace(r,s).replace(i,s).replace(o,s),h=c.indexOf("(");h>0&&(c=c.slice(0,h)),n[a]=c}return n.join(".")},i.$split=function(t){return i.$normalize(t).split(".")};var o=function(t){var e=n.createElement("div");return e.appendChild(n.createTextNode(t)),e.innerHTML},s="waffle-",a="waffle-grid",u=s+"sortable",c=u+"-asc",h=u+"-desc",l=s+"fixedheader",f=s+"selectable",d=s+"selected",p=s+"checkbox",v="data-waffle-",$=v+"id",g=v+"sortable",m=v+"order",y=v+"idx",b="+",C="-",x=function(){var t="key_",n=function(n){return t+n},e=function(){return this instanceof e?void(this.$o={}):new e};return e.prototype={clear:function(){this.$o={}},put:function(t,e){return this.$o[n(t)]=e,this},get:function(t){return this.$o[n(t)]},remove:function(t){return delete this.$o[n(t)],this},contains:function(t){return r.has(this.$o,n(t))}},e}(),k={toPx:function(t){return r.isNumber(t)?t+"px":t},fromPx:function(t){return r.isString(t)?Number(t.replace("px","")):t},capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},destroy:function(t){for(var n in t)r.has(t,n)&&(t[n]=null)},asyncTask:function(t,n,e,r){var i=0,o=function(){if(t.length>0){var s=t.shift();e(s,i),i+=s.length,t.length>0?setTimeout(o,n):(r(),o=null)}};setTimeout(o)}},w=function(){var t=function(){var t=n.createElement("div");t.style.width="100px",t.style.height="100px",t.style.overflow="scroll",t.style.position="absolute",t.style.top="-9999px",n.body.appendChild(t);var e=t.offsetWidth-t.clientWidth;return n.body.removeChild(t),e},e=function(){return"body"},i={create:function(t){return n.createElement(t)},byId:function(t){var e=n.getElementById(t);return e?[e]:[]},byTagName:function(t,e){return(e||n).getElementsByTagName(t)},createFragment:function(){return n.createDocumentFragment()},findParent:function(t,n){for(;t&&t.tagName!==n;)t=t.parentNode;return t},updateAttributes:function(t,n){var e=t.attributes,i=n.attributes;r.forEach(i,function(n,r){var o=e[r].value,s=i[r].value;o!==s&&t.setAttribute(n.name,s)})},updateClassName:function(t,n){var e=t.className,r=n.className;e!==r&&(t.className=n.className)},updateContent:function(t,n){var e=t.innerHTML,r=n.innerHTML;e!==r&&(t.innerHTML=r)},scrollbarWidth:r.memoize(t,e)};return r.forEach(["tr","td","th","tbody","thead","tfoot","input","span"],function(t){i[t]=function(){return this.create(t)}}),r.forEach(["text","checkbox"],function(t){var n="input"+k.capitalize(t);i[n]=function(){var n=this.input();return n.setAttribute("type",t),n}}),i}(),E=function(){var t=r.noop,n=function(t,n,e){this.type=t,this.bubbles=!1,this.cancelable=!1,this.details=e,this.target=n,this.currentTarget=n,this.timeStamp=r.now()};n.prototype={preventDefault:t,stopPropagation:t,stopImmediatePropagation:t};var e=function(t){return t.toLowerCase()},i=function(){this.$events={}};return i.prototype={addEventListener:function(t,n){var r=e(t),i=this.$events,o=i[r]=i[r]||[];o.push(n)},removeEventListener:function(t,n){var i=e(t),o=this.$events[i];o&&o.length&&(this.$events[i]=r.reject(o,function(t){return t===n}))},dispatchEvent:function(t,i,o){i=e(i);var s=this.$events[i];if(s&&s.length)for(var a=new n(i,t,r.isFunction(o)?o.call(t):o),u=0,c=s.length;c>u;++u)try{s[u].call(t,a)}catch(h){}},clear:function(){this.$events={}}},i}(),N=function(){var t=function(t){return t&&t.length>0},n=function(t){t.callback.call(t.ctx,this.$$changes)},e=function(){var e=this.$$changes,i=this.$$observers;t(e)&&t(i)&&r.forEach(i,n,this),this.clearChanges()},i={observe:function(t,n){return this.$$observers=this.$$observers||[],this.$$observers.push({ctx:n||null,callback:t}),this},unobserve:function(n,e){if(t(this.$$observers))if(0===arguments.length)this.$$observers=[];else{var i=e||null;this.$$observers=r.reject(this.$$observers,function(t){return t.ctx===i&&n===t.callback})}return this},trigger:function(t){return this.$$changes=(this.$$changes||[]).concat(t),setTimeout(r.bind(e,this)),this},clearChanges:function(){return this.$$changes=[],this}};return i}(),A=function(){var t=Array.prototype,n=function(){try{var n={};return n[0]=1,!!t.toString.call(n)}catch(e){return!1}}(),o=function(e){return function(){var i=n?this:r.toArray(this);return t[e].apply(i,arguments)}},s=function(t,n,e){return o(t).apply(n,e)},a=function(t,n){var e=n||{};this.$$map=new x,this.$$model=e.model||Object,this.$$key=e.key||"id",r.isFunction(this.$$key)||(this.$$key=i(this.$$key)),this.length=0,t&&t.length&&this.push.apply(this,t)},u=function(t){return parseInt(Number(t)||0,10)},c="splice",h="update",l=function(t,n,e,r,i){return{type:t,removed:n,index:e,addedCount:r,object:i}},f=function(t,n){delete t[n]},d=function(t,n){t.$$map.remove(n)},p=function(t,n){var e=t.$$key(n),r=t.$$map.get(e),i=r?r.idx:null;null!=i&&(f(t,i),d(t,e))},v=function(t,n){if(!r.isObject(n))throw new Error("Waffle collections are not array, only object are allowed");return n instanceof t.$$model?n:new t.$$model(n)},$=function(t,n,e,r){if(t[e]=n,null!=n){var i=arguments.length,o=3===i?t.$$key(n):r,s=t.$$map.get(o)||{};s.idx=e,t.$$map.put(o,s)}},g=function(t,n){var e=t.indexOf(n);return t[e]=n,l(h,[],e,0,t)},m=function(t,n,e){var r=t.at(e),i=t.at(n);$(t,i,e),$(t,r,n)},y=function(t,n,e){for(var r=Math.abs(e),i=t.length-1;i>=n;--i)m(t,i,i+r);t.length+=r},b=function(t,n,e){for(var r=Math.abs(e),i=t.length,o=i-r,s=n+r,a=[],u=s;i>u;++u)m(t,u,u-r);for(var c=o;i>c;++c){var h=t.at(c);a.unshift(h),p(t,h)}return t.length=o,a},C=function(t,n){for(var e,i=t.$$sortFn,o=t.length,s=n.length,a=o+s,u=[],h=o-1,f=s-1,d=a-1;d>=0;--d)if(0>h||i(t[h],n[f])<0){if($(t,n[f--],d),e=r.first(u),e&&e.index===d+1?(e.index=d,e.addedCount++):(e=l(c,[],d,1,t),u.unshift(e)),0>f)break}else $(t,t[h--],d);return t.length=a,u};return a.prototype={options:function(){return{model:this.$$model,key:this.$$key}},at:function(t){return this[t]},byKey:function(t){var n=this.indexOf(t);return n>=0?this.at(n):e},indexOf:function(t){var n=r.isObject(t)?this.$$key(t):t;return this.$$map.contains(n)?this.$$map.get(n).idx:-1},contains:function(t){return this.indexOf(t)>=0},findIndex:function(t,n){for(var e=0,r=this.length;r>e;++e)if(t.call(n,this.at(e),e,this))return e;return-1},add:function(t,n){var e=null==n?this.length:n,r=[e,0].concat(t);return this.splice.apply(this,r),this.length},remove:function(t,n){if(r.isNumber(t))return this.splice.call(this,t,n||this.length);if(r.isArray(t)){var e=this.$$key,i=r.indexBy(t,e);return this.remove(function(t){return!!i[e(t)]})}for(var o=t,s=n,a=0,u=null,h=[],p=[],v=0,g=this.length;g>v;++v){var m=this.at(v),y=this.$$key(m);o.call(s,m,v)?(f(this,v),d(this,y),u===v-1?r.last(h).removed.push(m):h.push(l(c,[m],v,0,this)),p.push(m),u=v):(a!==v&&(f(this,v),d(this,y),$(this,m,a,y)),a++)}return this.length-=p.length,h.length>0&&this.trigger(h),p},replace:function(t){var n=[0,0].concat(t);return this.splice.apply(this,n),this},push:function(){return this.add.call(this,r.toArray(arguments))},unshift:function(){return this.add.call(this,r.toArray(arguments),0)},pop:function(){return this.remove(this.length-1,1)[0]},shift:function(){return this.remove(0,1)[0]},toggle:function(t){var n=this.indexOf(t);return n>=0?this.remove(n,1):this.push(t)},clear:function(){if(this.length>0){for(var t=[],n=0,e=this.length;e>n;++n)t[n]=this.at(n),f(this,n);this.$$map.clear(),this.length=0,this.trigger(l(c,t,0,0,this))}return this},reset:function(t){var n=this.length,e=t.length,r=this.$$sortFn;r&&t.sort(r),this.$$map.clear();for(var i=[],o=t.length,s=0;e>s;++s)n>s&&i.push(this.at(s)),$(this,v(this,t[s]),s);for(;n>s;++s)i.push(this.at(s)),f(this,s);return this.length=e,this.trigger([l(c,i,0,o,this)]),this},isEmpty:function(){return 0===this.length},concat:function(){var n=t.concat.apply(this.toArray(),arguments);return new a(n,this.options())},slice:function(){var t=s("slice",this,arguments);return new a(t,this.options())},splice:function(t,n){var e=this.$$sortFn,i=this.length,o=r.rest(arguments,2),s=function(t){return v(this,t)},a=r.map(o,s,this),h=u(t);h=h>=0?Math.min(i,h):Math.max(i+h,0);var f=Math.min(Math.max(u(n)||0,0),i-h),d=[];if(f>0){for(var p=0;f>p;++p)d.push(this[p+h]);b(this,h,f)}var m,x=r.groupBy(a,this.contains,this),k=x[!0]||[],w=x[!1]||[],E=w.length,N=k.length;if(E>0)if(e)w.sort(e),m=C(this,w);else{y(this,h,E);for(var A=0;E>A;++A)$(this,w[A],h+A);m=[l(c,d,h,E,this)]}else m=[];if(d.length>0){var S=r.find(m,function(t){return t.index===h});S?S.removed=d:m.unshift(l(c,d,h,0,this))}var T=[];if(N>0){e&&k.sort(e);for(var B=0;N>B;++B)T.push(g(this,k[B]))}var O=m.concat(T);return O.length>0&&this.trigger(O),d},reverse:function(){if(this.$$sortFn)return this;for(var t=this.length,n=Math.floor(t/2),e=[],r=[],i=0,o=t-1;n>i;++i,--o)m(this,i,o),e.push(l(h,[],i,0,this)),r.unshift(l(h,[],o,0,this));var s=e.concat(r);return s.length&&this.trigger(s),this},split:function(t){for(var n=t||20,e=[],r=[],i=0,o=this.length;o>i;++i)r.push(this.at(i)),r.length===n&&(e.push(r),r=[]);return r.length>0&&e.push(r),e},toJSON:function(){return JSON.stringify(this.toArray())},sort:function(t){return this.$$sortFn=t,this.reset(this.toArray()).clearChanges()},pluck:function(t){return this.map(i(t))}},a.prototype.lastIndexOf=a.prototype.indexOf,r.extend(a.prototype,N),r.forEach(["size","first","last","initial","rest","partition","forEach","map","every","some","reduce","reduceRight","filter","reject","find","toArray"],function(t){r[t]&&(a.prototype[t]=function(){var n=[this].concat(r.toArray(arguments));return r[t].apply(r,n)})}),r.forEach(["countBy","groupBy","indexBy"],function(t){a.prototype[t]=function(n,e){return r.isString(n)&&(n=i(n)),r[t].call(r,this,n,e)}}),r.forEach(["toString","toLocaleString","join"],function(t){a.prototype[t]=o(t)}),a}(),S=function(){var t=function(t){return(null==t?"":t).toString()},n={$identity:r.identity,$empty:function(){return""},$lowercase:function(n){return t(n).toLowerCase()},$uppercase:function(n){return t(n).toUpperCase()},$capitalize:function(n){return k.capitalize(t(n))},$get:function(t){return n[t]}};return n}(),T={$string:function(t,n){var e=null==t?"":String(t),r=null==n?"":String(n);return e.localeCompare(r)},$number:function(t,n){var e=null==t?0:Number(t),r=null==n?0:Number(n);return e-r},$boolean:function(t,n){var e="false"===t?0:Boolean(t)?1:0,r="false"===n?0:Boolean(n)?1:0;return e-r},$date:function(t,n){var e=new Date(null==t?0:t).getTime(),r=new Date(null==n?0:n).getTime();return e-r},$auto:function(t,n){if(t===n||null==t&&null==n)return 0;var e=r.find(["Number","Boolean","Date","String"],function(e){var i=r["is"+e];return i(t)||i(n)});return e?T["$"+e.toLowerCase()](t,n):n>t?-1:1},$get:function(t){return T[t]}},B=function(t){return r.isArray(t)||(t=[t]),function(n,e){if(n===e||null==n&&null==e)return 0;for(var r=0,i=t.length;i>r;++r){var o=t[r],s=o.parser(n),a=o.parser(e),u=o.fn.call(T,s,a);if(u)return o.desc?-1*u:u}return 0}},O=function(){var t={".":"-","(":"",")":"","[":"-","]":"-","'":"",'"':""},n=r.isUndefined,e="$identity",s="$auto",a=k.fromPx,l=k.toPx,f=function(t,n,e){return r.isString(t)&&(t=n.$get(t)),r.isFunction(t)||(t=n.$get(e)),t},d=function(u){var c=u.escape,h=u.sortable;if(this.id=u.id,this.title=u.title||"",this.field=u.field||this.id,this.css=u.css||"",this.escape=n(c)?!0:!!c,this.width=a(u.width),this.sortable=n(h)?!0:!!h,this.asc=n(u.asc)?null:!!u.asc,!this.css)for(var l=0,d=this.id.length;d>l;++l){var p=this.id.charAt(l),v=t[p];this.css+=null!=v?v:p}c&&(this.title=o(this.title));var $=u.renderer||e,g=r.isArray($)?$:[$];this.$renderer=r.map(g,function(t){return f(t,S,e)}),this.$comparator=f(u.comparator,T,s),this.$parser=i(this.field)};return d.prototype={cssClasses:function(){var t=[this.css];this.sortable&&t.push(u);var n=this.asc;return null!=n&&t.push(n?c:h),t.join(" ")},attributes:function(t,n){var e={};if(e[$]=this.id,n&&this.sortable){e[g]=!0;var r=this.asc;null!=r&&(e[m]=r?b:C)}return e},styles:function(){var t={},n=l(this.width);return n&&(t.width=n,t.maxWidth=n,t.minWidth=n),t},updateWidth:function(t){return this.width=a(t),this},render:function(t){var n=this.field,e=null==t?"":this.$parser(t),i=r.reduce(this.$renderer,function(e,r){return r.call(S,e,t,n)},e);return null==i?"":this.escape?o(i):i}},d}(),j={theadRow:function(t){var n=w.tr();return t.hasCheckbox()&&n.appendChild(j.theadCheckboxCell(t)),t.$columns.forEach(function(e,r){n.appendChild(j.theadCell(t,e,r))}),n},theadCell:function(n,e,r){return t(w.th()).addClass(e.cssClasses(r,!0)).css(e.styles(r,!0)).attr(e.attributes(r,!0)).html(e.title)[0]},theadCheckboxCell:function(n){var e=n.$selection.size(),r=n.$data.size(),i=t(w.span()).attr("title",e).html(e),o=t(w.inputCheckbox()).prop("checked",n.isSelected()).prop("indeterminate",e>0&&e!==r);return t(w.th()).addClass(p).append(i[0]).append(o[0])[0]},tfootRow:function(t){var n=w.tr();return t.hasCheckbox()&&n.appendChild(j.tfootCheckboxCell(t)),t.$columns.forEach(function(e,r){n.appendChild(j.tfootCell(t,e,r))}),n},tfootCell:function(t,n,e){return j.theadCell(t,n,e)},tfootCheckboxCell:function(t){var n=j.theadCheckboxCell(t);return n.appendChild(n.childNodes[0]),n},tbodyRows:function(t,n,e){for(var r=w.createFragment(),i=0,o=n.length;o>i;++i)r.appendChild(j.tbodyRow(t,n[i],e+i));return r},tbodyRow:function(n,e,r){var i=t(w.tr());return i.attr(y,r),n.isSelectable()&&n.$selection.contains(e)&&i.addClass(d),n.hasCheckbox()&&i[0].appendChild(j.tbodyCheckboxCell(n,e)),n.$columns.forEach(function(t,r){i[0].appendChild(j.tbodyCell(n,e,t,r))}),i[0]},tbodyCell:function(n,e,r,i){return t(w.td()).addClass(r.cssClasses(i,!1)).css(r.styles(i,!1)).attr(r.attributes(i,!1)).html(r.render(e))[0]},tbodyCheckboxCell:function(n,e){var r=t(w.inputCheckbox()).prop("checked",n.isSelected(e));return t(w.td()).addClass(p).append(r[0])[0]}},z=function(){var t="THEAD",n="TFOOT",e="TBODY",i="TH",o="TR",s="INPUT",a=function(t){return t.tagName===s&&"checkbox"===t.getAttribute("type")},u=function(t,n){var e=t.target,o=w.findParent(t.target,i);if(e.tagName!==n)if(this.isSelectable()&&a(e))e.checked?this.select():this.deselect();else if(o&&o.getAttribute(g)){var s,u=o.getAttribute($),c=o.getAttribute(m)||C,h=c===b?C:b,l=h+u;if(t.shiftKey){var f=c+u;s=r.reject(this.$sortBy,function(t){return t===f})}else s=[];s.push(l),this.sortBy(s)}},c={onClickThead:function(n){return u.call(this,n,t)},onClickTfoot:function(t){return u.call(this,t,n)},onClickTbody:function(t){if(this.isSelectable()&&t.target.tagName!==e){var n=w.findParent(t.target,o),r=n.getAttribute(y),i=this.$data.at(r),s=this.$selection;if(this.options.selection.multi)if(t.shiftKey){for(var a=parseFloat(r),u=parseFloat(this.$$selectAnchor),c=Math.min(a,u),h=Math.max(a,u),l=[],f=c;h>=f;++f){var d=this.$data.at(f);s.contains(d)||l.push(d)}l.length>0&&s.push.apply(s,l)}else s.toggle(i),this.$$selectAnchor=r;else{var p=s.indexOf(i);p>=0?s.remove(p,1):s.reset([i])}}}};return c}(),F={on:function(t,n){return r.forEach(n,function(n){var e="on"+k.capitalize(n.type);F[e].call(F,t,n)}),this},onSplice:function(t,n){var e,i,o,s=t.$tbody,a=s[0],u=a.childNodes,c=n.index,h=n.addedCount,l=n.object,f=n.removed,d=f.length;if(d>0){if(0===c&&d===u.length)e=r.toArray(u),s.empty();else{e=[];for(var p=0;d>p;++p)e.push(a.removeChild(u[c]))}var v=t.$selection;v&&v.length>0&&v.remove(f)}if(h>0){i=[],o=[];for(var $=w.createFragment(),g=0;h>g;++g){var m=g+c,b=l.at(m),C=j.tbodyRow(t,b,m);i.push(C),o.push(b),$.appendChild(C)}c>0?s.children().eq(c-1).after($):s.prepend($)}if(e||i){for(var x=c+h,k=u.length;k>x;++x)u[x].setAttribute(y,x);t.dispatchEvent("dataspliced",{added:o||[],addedNodes:i||[],removedNodes:e||[],removed:f,index:c})}return this},onUpdate:function(t,n){var e=n.index,i=t.$data.at(e),o=t.$tbody[0],s=o.childNodes[e],a=j.tbodyRow(t,i,e);w.updateAttributes(s,a),w.updateClassName(s,a);var u=s.childNodes,c=a.childNodes;return r.forEach(c,function(t,n){var e=u[n];w.updateAttributes(e,t),w.updateClassName(e,t),w.updateContent(e,t)}),t.dispatchEvent("dataupdated",{updatedNode:s}),this}},L=function(){var n=function(t){return t.childNodes[0].childNodes[0]},e=function(t,n){t.checked=n},i={on:function(t,n){return r.forEach(n,function(n){var e="on"+k.capitalize(n.type),r=L[e];r&&r.call(L,t,n)}),this},onSplice:function(r,i){var o,s,a=r.$tbody,u=r.$data,c=i.object,h=a[0],l=h.childNodes,f=i.index,p=i.removed,v=i.addedCount,$=p.length;if($>0)for(var g=0;$>g;++g)o=u.indexOf(p[g]),o>=0&&(s=l[o],t(s).removeClass(d),r.hasCheckbox()&&e(n(s),!1));if(v>0)for(var m=0;v>m;++m)o=u.indexOf(c.at(f+m)),s=l[o],t(s).addClass(d),r.hasCheckbox()&&e(n(s),!0);if(v>0||$>0){var y=v-$;if(y&&r.hasCheckbox()){var b=c.length,C=r.$thead[0],x=r.$tfoot[0],k=C.childNodes[0].childNodes[0],w=k.childNodes[0],E=k.childNodes[1],N=x.childNodes[0].childNodes[0],A=N.childNodes[1],S=N.childNodes[0];A.innerHTML=w.innerHTML=b,A.title=w.title=b,S.checked=E.checked=r.isSelected(),S.indeterminate=E.indeterminate=b>0&&u.length!==b}r.dispatchEvent("selectionchanged",function(){return{selection:this.$selection.toArray()}})}return this}};return i}(),M=function(){var n=k.toPx,e=k.fromPx,o=function(t){var n=t||[];return r.isArray(n)||(n=[n]),r.map(n,function(t){var n=t.charAt(0);return n!==b&&n!==C?b+t:t})},s=function(n){var e="$"+n,r=this.$table;this[e]=t(w.byTagName(n,r[0])),this[e].length||(this[e]=t(w[n]())),r.append(this[e][0])},u=function(t){return F.on(this,t)},d=function(t){return L.on(this,t)},p=function(t){var n=this.options.events[t];n&&this.addEventListener(t.slice(2),this.options.events[t])},v=function(n,i){if(!(this instanceof v))return new v(n,i);var o=i=i||{},c=v.options;r.forEach(["events","selection","size"],function(t){var n=o[t];(r.isObject(n)||r.isUndefined(n))&&(o[t]=r.defaults(n||{},c[t]))}),this.options=r.defaults(o,c),o.size={width:e(o.size.width),height:e(o.size.height)},o.scrollable=o.scrollable||!!o.size.height;var h=this.isSelectable(),$=this.isSortable(),g=o.scrollable;this.$table=t(n),this.$data=new A(o.data,{key:o.key,model:o.model}),$||r.forEach(o.columns,function(t){t.sortable=!1}),this.$columns=new A(o.columns,{key:"id",model:O}),this.$sortBy=[],this.$table.addClass(a),h&&this.$table.addClass(f),g&&this.$table.addClass(l),r.forEach(["thead","tbody","tfoot"],s,this),(h||$)&&(this.$thead.on("click",r.bind(z.onClickThead,this)),this.$tfoot.on("click",r.bind(z.onClickTfoot,this))),this.$data.observe(u,this),h&&(this.$selection=new A([],this.$data.options()),this.$tbody.on("click",r.bind(z.onClickTbody,this)),this.$selection.observe(d,this)),this.$bus=new E,r.forEach(r.keys(o.events),p,this),(o.size.height||o.size.width)&&this.assignWidth(),this.renderHeader().renderFooter().sortBy(i.sortBy,!1).renderBody(),this.dispatchEvent("initialized")};return v.create=function(t,n){return new v(t,n)},v.prototype={data:function(){return this.$data},columns:function(){return this.$columns},selection:function(){return this.$selection},isSortable:function(){return this.options.sortable},isSelectable:function(){var t=this.options.selection;return t&&t.enable},hasCheckbox:function(){return this.isSelectable()&&this.options.selection.checkbox},isSelected:function(t){if(!this.isSelectable())return!1;if(t)return this.$selection.contains(t);var n=this.$data.length,e=this.$selection.length;return n>0&&n===e},render:function(){return this.renderHeader().renderFooter().renderBody()},assignWidth:function(){var t=this.options.size,e=t.width;if(t.height){var r=n(t.width);this.$table.css({width:r,maxWidth:r,minWidth:r}),this.$tbody.css({maxHeight:n(t.height)}),e-=w.scrollbarWidth(),this.hasCheckbox()&&(e-=30)}var i=0,o=0;this.$columns.forEach(function(t){var n=t.width;n&&(i+=n,++o)});var s=this.$columns.length,a=s-o,u=0,c=0;if(a){var h=(e-i)/a;u=Math.floor(h),c=h-u}var l=0;return this.$columns.forEach(function(t){var n=t.width,e=n||0;e||(l+=c,l>=1?(e=u+1,l--):e=u),e!==n&&t.updateWidth(e)}),this},renderHeader:function(){var t=j.theadRow(this);return this.$thead.empty().append(t),this},renderFooter:function(){var t=j.tfootRow(this);return this.$tfoot.empty().append(t),this},renderBody:function(t){var n=null==t?this.options.async:t,e=this,i=r.once(function(){e.$tbody.empty()}),o=function(t,n){var r=j.tbodyRows(e,t,n);i(),e.$tbody.append(r)},s=function(){e.$data.clearChanges(),e.dispatchEvent("rendered",function(){return{data:this.$data,nodes:r.toArray(this.$tbody[0].childNodes)}}),e=i=o=s=null};return n?k.asyncTask(this.$data.split(200),10,o,s):(o(this.$data,0),s()),this},select:function(){return this.$selection.length!==this.$data.length&&this.$selection.add(this.$data.toArray()),this},deselect:function(){return this.$selection.isEmpty()||this.$selection.clear(),this},sortBy:function(t,n){var e=o(t);if(this.$sortBy===e||this.$sortBy.join()===e.join())return this;this.$sortBy=e;var s=this.$thead.children().eq(0).children(),a=this.$tfoot.children().eq(0).children();s.removeClass(c+" "+h).removeAttr(m),a.removeClass(c+" "+h).removeAttr(m);var u=this.$columns,l=this.hasCheckbox(),f=r.map(this.$sortBy,function(t){var n,e=t.charAt(0),r=t.substr(1),o=e===b,f=u.indexOf(r),d=l?f+1:f;return f>=0?(n=u.at(f),n.asc=o,s.eq(d).addClass(o?c:h).attr(m,e),a.eq(d).addClass(o?c:h).attr(m,e)):n={},{parser:n.$parser||i(t),fn:n.$comparator||T.$auto,desc:!o}});return this.$data.sort(B(f)),n!==!1&&this.renderBody(),this.dispatchEvent("sorted")},dispatchEvent:function(t,n){return this.$bus.dispatchEvent(this,t,n),this},addEventListener:function(t,n){return this.$bus.addEventListener(t,n),this},removeEventListener:function(t,n){return this.$bus.removeEventListener(t,n),this},destroy:function(){this.$thead.off(),this.$tfoot.off(),this.$tbody.off(),this.$data.unobserve(),this.$selection.unobserve(),this.$bus.clear(),k.destroy(this)}},v.options={key:"id",async:!1,scrollable:!1,sortable:!0,selection:{enable:!0,checkbox:!0,multi:!1},size:{width:null,height:null},events:{}},r.forEach(["onInitialized","onRendered","onDataSpliced","onDataUpdated","onSelectionChanged","onSorted"],function(t){v.options.events[t]=null}),v}(),R={Grid:M,addRenderer:function(t,n){return S[t]=n,R},addComparator:function(t,n){return T[t]=n,R}};return R})}(window,document,void 0);