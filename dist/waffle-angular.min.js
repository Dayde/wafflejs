!function(t,e,n,r){"use strict";var i=function(){var t=Array.prototype,e=t.slice,n=Object.prototype,i=Object.keys,s=n.hasOwnProperty,o=n.toString,a=Function.prototype.bind,u=function(t){return c.isString(t)?function(e){return e[t]}:t},h=function(t){return function(e,n,r){for(var i={},s=u(n),o=0,a=e.length;a>o;++o){var h=s.call(r,e[o],o,e);t(i,e[o],h)}return i}},c={};return c.isNull=function(t){return null===t},c.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"===o.call(t)},c.bind=function(t,e){return a?t.bind(e):function(){return t.apply(e,arguments)}},c.toArray=function(t){return c.map(t,function(t){return t})},c.once=function(t){var e,n=!1;return function(){return n||(n=!0,e=t.apply(this,arguments),t=null),e}},c.defaults=function(t,e){return c.forEach(c.keys(e),function(n){c.isUndefined(t[n])&&(t[n]=e[n])}),t},c.result=function(t,e){var n=t[e];return c.isFunction(n)?n.call(t):n},c.has=function(t,e){return s.call(t,e)},c.size=function(t){return t.length},c.first=function(t,n){return null==n?t[0]:e.call(t,0,n)},c.last=function(t,n){return null==n?t[t.length-1]:e.call(t,t.length-n,t.length)},c.rest=function(t,n){var r=arguments.length>1?n:1;return e.call(t,r,t.length)},c.initial=function(t,n){var r=t.length,i=arguments.length>1?r-n:r-1;return e.call(t,0,i)},c.indexOf=function(t,e){for(var n=0,r=t.length;r>n;++n)if(t[n]===e)return n;return-1},c.lastIndexOf=function(t,e){for(var n=t.length-1;n>=0;--n)if(t[n]===e)return n;return-1},c.contains=function(t,e){return c.indexOf(t,e)>=0},c.keys=function(t){if(!c.isObject(t))return[];if(i)return i(t);var e=[];for(var n in t)c.has(t,n)&&e.push(n);return e},c.functions=function(t){var e=[];for(var n in t)c.isFunction(t[n])&&e.push(n);return e.sort()},c.map=function(t,e,n){for(var r=[],i=0,s=t.length;s>i;++i)r[i]=e.call(n,t[i],i,t);return r},c.every=function(t,e,n){for(var r=0,i=t.length;i>r;++r)if(!e.call(n,t[r],r,t))return!1;return!0},c.some=function(t,e,n){for(var r=0,i=t.length;i>r;++r)if(e.call(n,t[r],r,t))return!0;return!1},c.filter=function(t,e,n){for(var r=[],i=0,s=t.length;s>i;++i)e.call(n,t[i],i,t)&&r.push(t[i]);return r},c.reject=function(t,e,n){for(var r=[],i=0,s=t.length;s>i;++i)e.call(n,t[i],i,t)||r.push(t[i]);return r},c.reduce=function(t,e,n){for(var r=arguments.length,i=3===r?n:t[0],s=t.length,o=3===r?0:1;s>o;++o)i=e.call(null,i,t[o],o,t);return i},c.reduceRight=function(t,e,n){for(var r=arguments.length,i=t.length-1,s=3===r?n:t[i],o=3===r?i:i-1;o>=0;--o)s=e.call(null,s,t[o],o,t);return s},c.find=function(t,e,n){for(var i=0,s=t.length;s>i;++i)if(e.call(n,t[i],i,t))return t[i];return r},c.partition=function(t,e){for(var n=[],r=[],i=0,s=t.length;s>i;++i)e.call(null,t[i],i,t)?n.push(t[i]):r.push(t[i]);return[n,r]},c.memoize=function(t,e){var n=function(r){var i=n.cache,s=e?e.apply(this,arguments):r;return c.has(i,s)||(i[s]=t.apply(this,arguments)),i[s]};return n.cache={},n},c.now=Date.now||function(){return(new Date).getTime()},c.indexBy=h(function(t,e,n){t[n]=e}),c.groupBy=h(function(t,e,n){(t[n]=t[n]||[]).push(e)}),c.countBy=h(function(t,e,n){t[n]=(t[n]||0)+1}),c}();n.forEach(["noop","identity","forEach","isUndefined","isFunction","isObject","isArray","isNumber","isDate","isElement","isString","extend"],function(t){i[t]=n[t]}),i.clone=n.copy;var s,o,a=n.element,u=n.module("waffle",[]);u.run(["$injector","$log","$filter",function(t,e,n){s=t.get("$parse");try{o=t.get("$sanitize")}catch(r){e.warn("Module ngSanitize is not available, you should add this module to avoid xss injection"),o=i.identity}var a=O.$get;O.$get=function(t){return a(t)||n(t)}}]);var h="waffle-",c="waffle-grid",l=h+"sortable",f=l+"-asc",d=l+"-desc",p=h+"fixedheader",v=h+"selectable",$=h+"selected",g=h+"checkbox",y="data-waffle-",m=y+"id",b=y+"sortable",C=y+"order",x=y+"idx",k="+",w="-",E=function(){var t="key_",e=function(e){return t+e},n=function(){return this instanceof n?void(this.$o={}):new n};return n.prototype={clear:function(){this.$o={}},put:function(t,n){return this.$o[e(t)]=n,this},get:function(t){return this.$o[e(t)]},remove:function(t){return delete this.$o[e(t)],this},contains:function(t){return i.has(this.$o,e(t))}},n}(),N={toPx:function(t){return i.isNumber(t)?t+"px":t},fromPx:function(t){return i.isString(t)?Number(t.replace("px","")):t},capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},destroy:function(t){for(var e in t)i.has(t,e)&&(t[e]=null)},asyncTask:function(t,e,n,r){var i=0,s=function(){if(t.length>0){var o=t.shift();n(o,i),i+=o.length,t.length>0?setTimeout(s,e):(r(),s=null)}};setTimeout(s)}},A=function(){var t=function(){var t=e.createElement("div");t.style.width="100px",t.style.height="100px",t.style.overflow="scroll",t.style.position="absolute",t.style.top="-9999px",e.body.appendChild(t);var n=t.offsetWidth-t.clientWidth;return e.body.removeChild(t),n},n=function(){return"body"},r={create:function(t){return e.createElement(t)},byId:function(t){var n=e.getElementById(t);return n?[n]:[]},byTagName:function(t,n){return(n||e).getElementsByTagName(t)},createFragment:function(){return e.createDocumentFragment()},findParent:function(t,e){for(;t&&t.tagName!==e;)t=t.parentNode;return t},updateAttributes:function(t,e){var n=t.attributes,r=e.attributes;i.forEach(r,function(e,i){var s=n[i].value,o=r[i].value;s!==o&&t.setAttribute(e.name,o)})},updateClassName:function(t,e){var n=t.className,r=e.className;n!==r&&(t.className=e.className)},updateContent:function(t,e){var n=t.innerHTML,r=e.innerHTML;n!==r&&(t.innerHTML=r)},scrollbarWidth:i.memoize(t,n)};return i.forEach(["tr","td","th","tbody","thead","tfoot","input","span"],function(t){r[t]=function(){return this.create(t)}}),i.forEach(["text","checkbox"],function(t){var e="input"+N.capitalize(t);r[e]=function(){var e=this.input();return e.setAttribute("type",t),e}}),r}(),S=function(){var t=i.noop,e=function(t,e,n){this.type=t,this.bubbles=!1,this.cancelable=!1,this.details=n,this.target=e,this.currentTarget=e,this.timeStamp=i.now()};e.prototype={preventDefault:t,stopPropagation:t,stopImmediatePropagation:t};var n=function(t){return t.toLowerCase()},r=function(){this.$events={}};return r.prototype={addEventListener:function(t,e){var r=n(t),i=this.$events,s=i[r]=i[r]||[];s.push(e)},removeEventListener:function(t,e){var r=n(t),s=this.$events[r];s&&s.length&&(this.$events[r]=i.reject(s,function(t){return t===e}))},dispatchEvent:function(t,r,s){r=n(r);var o=this.$events[r];if(o&&o.length)for(var a=new e(r,t,i.isFunction(s)?s.call(t):s),u=0,h=o.length;h>u;++u)try{o[u].call(t,a)}catch(c){}},clear:function(){this.$events={}}},r}(),B=function(){var t=function(t){return t&&t.length>0},e=function(t){t.callback.call(t.ctx,this.$$changes)},n=function(){var n=this.$$changes,r=this.$$observers;t(n)&&t(r)&&i.forEach(r,e,this),this.clearChanges()},r={observe:function(t,e){return this.$$observers=this.$$observers||[],this.$$observers.push({ctx:e||null,callback:t}),this},unobserve:function(e,n){if(t(this.$$observers))if(0===arguments.length)this.$$observers=[];else{var r=n||null;this.$$observers=i.reject(this.$$observers,function(t){return t.ctx===r&&e===t.callback})}return this},trigger:function(t){return this.$$changes=(this.$$changes||[]).concat(t),setTimeout(i.bind(n,this)),this},clearChanges:function(){return this.$$changes=[],this}};return r}(),T=function(){var t=Array.prototype,e=function(){try{var e={};return e[0]=1,!!t.toString.call(e)}catch(n){return!1}}(),n=function(n){return function(){var r=e?this:i.toArray(this);return t[n].apply(r,arguments)}},o=function(t,e,r){return n(t).apply(e,r)},a=function(t,e){var n=e||{};this.$$map=new E,this.$$model=n.model||Object,this.$$key=n.key||"id",i.isFunction(this.$$key)||(this.$$key=s(this.$$key)),this.length=0,t&&t.length&&this.push.apply(this,t)},u=function(t){return parseInt(Number(t)||0,10)},h="splice",c="update",l=function(t,e,n,r,i){return{type:t,removed:e,index:n,addedCount:r,object:i}},f=function(t,e){delete t[e]},d=function(t,e){t.$$map.remove(e)},p=function(t,e){var n=t.$$key(e),r=t.$$map.get(n),i=r?r.idx:null;null!=i&&(f(t,i),d(t,n))},v=function(t,e){if(!i.isObject(e))throw new Error("Waffle collections are not array, only object are allowed");return e instanceof t.$$model?e:new t.$$model(e)},$=function(t,e,n,r){if(t[n]=e,null!=e){var i=arguments.length,s=3===i?t.$$key(e):r,o=t.$$map.get(s)||{};o.idx=n,t.$$map.put(s,o)}},g=function(t,e){var n=t.indexOf(e);return t[n]=e,l(c,[],n,0,t)},y=function(t,e,n){var r=t.at(n),i=t.at(e);$(t,i,n),$(t,r,e)},m=function(t,e,n){for(var r=Math.abs(n),i=t.length-1;i>=e;--i)y(t,i,i+r);t.length+=r},b=function(t,e,n){for(var r=Math.abs(n),i=t.length,s=i-r,o=e+r,a=[],u=o;i>u;++u)y(t,u,u-r);for(var h=s;i>h;++h){var c=t.at(h);a.unshift(c),p(t,c)}return t.length=s,a},C=function(t,e){for(var n,r=t.$$sortFn,s=t.length,o=e.length,a=s+o,u=[],c=s-1,f=o-1,d=a-1;d>=0;--d)if(0>c||r(t[c],e[f])<0){if($(t,e[f--],d),n=i.first(u),n&&n.index===d+1?(n.index=d,n.addedCount++):(n=l(h,[],d,1,t),u.unshift(n)),0>f)break}else $(t,t[c--],d);return t.length=a,u};return a.prototype={options:function(){return{model:this.$$model,key:this.$$key}},at:function(t){return this[t]},byKey:function(t){var e=this.indexOf(t);return e>=0?this.at(e):r},indexOf:function(t){var e=i.isObject(t)?this.$$key(t):t;return this.$$map.contains(e)?this.$$map.get(e).idx:-1},contains:function(t){return this.indexOf(t)>=0},findIndex:function(t,e){for(var n=0,r=this.length;r>n;++n)if(t.call(e,this.at(n),n,this))return n;return-1},add:function(t,e){var n=null==e?this.length:e,r=[n,0].concat(t);return this.splice.apply(this,r),this.length},remove:function(t,e){if(i.isNumber(t))return this.splice.call(this,t,e||this.length);if(i.isArray(t)){var n=this.$$key,r=i.indexBy(t,n);return this.remove(function(t){return!!r[n(t)]})}for(var s=t,o=e,a=0,u=null,c=[],p=[],v=0,g=this.length;g>v;++v){var y=this.at(v),m=this.$$key(y);s.call(o,y,v)?(f(this,v),d(this,m),u===v-1?i.last(c).removed.push(y):c.push(l(h,[y],v,0,this)),p.push(y),u=v):(a!==v&&(f(this,v),d(this,m),$(this,y,a,m)),a++)}return this.length-=p.length,c.length>0&&this.trigger(c),p},replace:function(t){var e=[0,0].concat(t);return this.splice.apply(this,e),this},push:function(){return this.add.call(this,i.toArray(arguments))},unshift:function(){return this.add.call(this,i.toArray(arguments),0)},pop:function(){return this.remove(this.length-1,1)[0]},shift:function(){return this.remove(0,1)[0]},toggle:function(t){var e=this.indexOf(t);return e>=0?this.remove(e,1):this.push(t)},clear:function(){if(this.length>0){for(var t=[],e=0,n=this.length;n>e;++e)t[e]=this.at(e),f(this,e);this.$$map.clear(),this.length=0,this.trigger(l(h,t,0,0,this))}return this},reset:function(t){var e=this.length,n=t.length,r=this.$$sortFn;r&&t.sort(r),this.$$map.clear();for(var i=[],s=t.length,o=0;n>o;++o)e>o&&i.push(this.at(o)),$(this,v(this,t[o]),o);for(;e>o;++o)i.push(this.at(o)),f(this,o);return this.length=n,this.trigger([l(h,i,0,s,this)]),this},isEmpty:function(){return 0===this.length},concat:function(){var e=t.concat.apply(this.toArray(),arguments);return new a(e,this.options())},slice:function(){var t=o("slice",this,arguments);return new a(t,this.options())},splice:function(t,e){var n=this.$$sortFn,r=this.length,s=i.rest(arguments,2),o=function(t){return v(this,t)},a=i.map(s,o,this),c=u(t);c=c>=0?Math.min(r,c):Math.max(r+c,0);var f=Math.min(Math.max(u(e)||0,0),r-c),d=[];if(f>0){for(var p=0;f>p;++p)d.push(this[p+c]);b(this,c,f)}var y,x=i.groupBy(a,this.contains,this),k=x[!0]||[],w=x[!1]||[],E=w.length,N=k.length;if(E>0)if(n)w.sort(n),y=C(this,w);else{m(this,c,E);for(var A=0;E>A;++A)$(this,w[A],c+A);y=[l(h,d,c,E,this)]}else y=[];if(d.length>0){var S=i.find(y,function(t){return t.index===c});S?S.removed=d:y.unshift(l(h,d,c,0,this))}var B=[];if(N>0){n&&k.sort(n);for(var T=0;N>T;++T)B.push(g(this,k[T]))}var O=y.concat(B);return O.length>0&&this.trigger(O),d},reverse:function(){if(this.$$sortFn)return this;for(var t=this.length,e=Math.floor(t/2),n=[],r=[],i=0,s=t-1;e>i;++i,--s)y(this,i,s),n.push(l(c,[],i,0,this)),r.unshift(l(c,[],s,0,this));var o=n.concat(r);return o.length&&this.trigger(o),this},split:function(t){for(var e=t||20,n=[],r=[],i=0,s=this.length;s>i;++i)r.push(this.at(i)),r.length===e&&(n.push(r),r=[]);return r.length>0&&n.push(r),n},toJSON:function(){return JSON.stringify(this.toArray())},sort:function(t){return this.$$sortFn=t,this.reset(this.toArray()).clearChanges()},pluck:function(t){return this.map(s(t))}},a.prototype.lastIndexOf=a.prototype.indexOf,i.extend(a.prototype,B),i.forEach(["size","first","last","initial","rest","partition","forEach","map","every","some","reduce","reduceRight","filter","reject","find","toArray"],function(t){i[t]&&(a.prototype[t]=function(){var e=[this].concat(i.toArray(arguments));return i[t].apply(i,e)})}),i.forEach(["countBy","groupBy","indexBy"],function(t){a.prototype[t]=function(e,n){return i.isString(e)&&(e=s(e)),i[t].call(i,this,e,n)}}),i.forEach(["toString","toLocaleString","join"],function(t){a.prototype[t]=n(t)}),a}(),O=function(){var t=function(t){return(null==t?"":t).toString()},e={$identity:i.identity,$empty:function(){return""},$lowercase:function(e){return t(e).toLowerCase()},$uppercase:function(e){return t(e).toUpperCase()},$capitalize:function(e){return N.capitalize(t(e))},$get:function(t){return e[t]}};return e}(),z={$string:function(t,e){var n=null==t?"":String(t),r=null==e?"":String(e);return n.localeCompare(r)},$number:function(t,e){var n=null==t?0:Number(t),r=null==e?0:Number(e);return n-r},$boolean:function(t,e){var n="false"===t?0:Boolean(t)?1:0,r="false"===e?0:Boolean(e)?1:0;return n-r},$date:function(t,e){var n=new Date(null==t?0:t).getTime(),r=new Date(null==e?0:e).getTime();return n-r},$auto:function(t,e){if(t===e||null==t&&null==e)return 0;var n=i.find(["Number","Boolean","Date","String"],function(n){var r=i["is"+n];return r(t)||r(e)});return n?z["$"+n.toLowerCase()](t,e):e>t?-1:1},$get:function(t){return z[t]}},j=function(t){return i.isArray(t)||(t=[t]),function(e,n){if(e===n||null==e&&null==n)return 0;for(var r=0,i=t.length;i>r;++r){var s=t[r],o=s.parser(e),a=s.parser(n),u=s.fn.call(z,o,a);if(u)return s.desc?-1*u:u}return 0}},F=function(){var t={".":"-","(":"",")":"","[":"-","]":"-","'":"",'"':""},e=i.isUndefined,n="$identity",r="$auto",a=N.fromPx,u=N.toPx,h=function(t,e,n){return i.isString(t)&&(t=e.$get(t)),i.isFunction(t)||(t=e.$get(n)),t},c=function(u){var c=u.escape,l=u.sortable;if(this.id=u.id,this.title=u.title||"",this.field=u.field||this.id,this.css=u.css||"",this.escape=e(c)?!0:!!c,this.width=a(u.width),this.sortable=e(l)?!0:!!l,this.asc=e(u.asc)?null:!!u.asc,!this.css)for(var f=0,d=this.id.length;d>f;++f){var p=this.id.charAt(f),v=t[p];this.css+=null!=v?v:p}c&&(this.title=o(this.title));var $=u.renderer||n,g=i.isArray($)?$:[$];this.$renderer=i.map(g,function(t){return h(t,O,n)}),this.$comparator=h(u.comparator,z,r),this.$parser=s(this.field)};return c.prototype={cssClasses:function(){var t=[this.css];this.sortable&&t.push(l);var e=this.asc;return null!=e&&t.push(e?f:d),t.join(" ")},attributes:function(t,e){var n={};if(n[m]=this.id,e&&this.sortable){n[b]=!0;var r=this.asc;null!=r&&(n[C]=r?k:w)}return n},styles:function(){var t={},e=u(this.width);return e&&(t.width=e,t.maxWidth=e,t.minWidth=e),t},updateWidth:function(t){return this.width=a(t),this},render:function(t){var e=this.field,n=null==t?"":this.$parser(t),r=i.reduce(this.$renderer,function(n,r){return r.call(O,n,t,e)},n);return null==r?"":this.escape?o(r):r}},c}(),L={theadRow:function(t){var e=A.tr();return t.hasCheckbox()&&e.appendChild(L.theadCheckboxCell(t)),t.$columns.forEach(function(n,r){e.appendChild(L.theadCell(t,n,r))}),e},theadCell:function(t,e,n){return a(A.th()).addClass(e.cssClasses(n,!0)).css(e.styles(n,!0)).attr(e.attributes(n,!0)).html(e.title)[0]},theadCheckboxCell:function(t){var e=t.$selection.size(),n=t.$data.size(),r=a(A.span()).attr("title",e).html(e),i=a(A.inputCheckbox()).prop("checked",t.isSelected()).prop("indeterminate",e>0&&e!==n);return a(A.th()).addClass(g).append(r[0]).append(i[0])[0]},tfootRow:function(t){var e=A.tr();return t.hasCheckbox()&&e.appendChild(L.tfootCheckboxCell(t)),t.$columns.forEach(function(n,r){e.appendChild(L.tfootCell(t,n,r))}),e},tfootCell:function(t,e,n){return L.theadCell(t,e,n)},tfootCheckboxCell:function(t){var e=L.theadCheckboxCell(t);return e.appendChild(e.childNodes[0]),e},tbodyRows:function(t,e,n){for(var r=A.createFragment(),i=0,s=e.length;s>i;++i)r.appendChild(L.tbodyRow(t,e[i],n+i));return r},tbodyRow:function(t,e,n){var r=a(A.tr());return r.attr(x,n),t.isSelectable()&&t.$selection.contains(e)&&r.addClass($),t.hasCheckbox()&&r[0].appendChild(L.tbodyCheckboxCell(t,e)),t.$columns.forEach(function(n,i){r[0].appendChild(L.tbodyCell(t,e,n,i))}),r[0]},tbodyCell:function(t,e,n,r){return a(A.td()).addClass(n.cssClasses(r,!1)).css(n.styles(r,!1)).attr(n.attributes(r,!1)).html(n.render(e))[0]},tbodyCheckboxCell:function(t,e){var n=a(A.inputCheckbox()).prop("checked",t.isSelected(e));return a(A.td()).addClass(g).append(n[0])[0]}},M=function(){var t="THEAD",e="TFOOT",n="TBODY",r="TH",s="TR",o="INPUT",a=function(t){return t.tagName===o&&"checkbox"===t.getAttribute("type")},u=function(t,e){var n=t.target,s=A.findParent(t.target,r);if(n.tagName!==e)if(this.isSelectable()&&a(n))n.checked?this.select():this.deselect();else if(s&&s.getAttribute(b)){var o,u=s.getAttribute(m),h=s.getAttribute(C)||w,c=h===k?w:k,l=c+u;if(t.shiftKey){var f=h+u;o=i.reject(this.$sortBy,function(t){return t===f})}else o=[];o.push(l),this.sortBy(o)}},h={onClickThead:function(e){return u.call(this,e,t)},onClickTfoot:function(t){return u.call(this,t,e)},onClickTbody:function(t){if(this.isSelectable()&&t.target.tagName!==n){var e=A.findParent(t.target,s),r=e.getAttribute(x),i=this.$data.at(r),o=this.$selection;if(this.options.selection.multi)if(t.shiftKey){for(var a=parseFloat(r),u=parseFloat(this.$$selectAnchor),h=Math.min(a,u),c=Math.max(a,u),l=[],f=h;c>=f;++f){var d=this.$data.at(f);o.contains(d)||l.push(d)}l.length>0&&o.push.apply(o,l)}else o.toggle(i),this.$$selectAnchor=r;else{var p=o.indexOf(i);p>=0?o.remove(p,1):o.reset([i])}}}};return h}(),R={on:function(t,e){return i.forEach(e,function(e){var n="on"+N.capitalize(e.type);R[n].call(R,t,e)}),this},onSplice:function(t,e){var n,r,s,o=t.$tbody,a=o[0],u=a.childNodes,h=e.index,c=e.addedCount,l=e.object,f=e.removed,d=f.length;if(d>0){if(0===h&&d===u.length)n=i.toArray(u),o.empty();else{n=[];for(var p=0;d>p;++p)n.push(a.removeChild(u[h]))}var v=t.$selection;v&&v.length>0&&v.remove(f)}if(c>0){r=[],s=[];for(var $=A.createFragment(),g=0;c>g;++g){var y=g+h,m=l.at(y),b=L.tbodyRow(t,m,y);r.push(b),s.push(m),$.appendChild(b)}h>0?o.children().eq(h-1).after($):o.prepend($)}if(n||r){for(var C=h+c,k=u.length;k>C;++C)u[C].setAttribute(x,C);t.dispatchEvent("dataspliced",{added:s||[],addedNodes:r||[],removedNodes:n||[],removed:f,index:h})}return this},onUpdate:function(t,e){var n=e.index,r=t.$data.at(n),s=t.$tbody[0],o=s.childNodes[n],a=L.tbodyRow(t,r,n);A.updateAttributes(o,a),A.updateClassName(o,a);var u=o.childNodes,h=a.childNodes;return i.forEach(h,function(t,e){var n=u[e];A.updateAttributes(n,t),A.updateClassName(n,t),A.updateContent(n,t)}),t.dispatchEvent("dataupdated",{updatedNode:o}),this}},W=function(){var t=function(t){return t.childNodes[0].childNodes[0]},e=function(t,e){t.checked=e},n={on:function(t,e){return i.forEach(e,function(e){var n="on"+N.capitalize(e.type),r=W[n];r&&r.call(W,t,e)}),this},onSplice:function(n,r){var i,s,o=n.$tbody,u=n.$data,h=r.object,c=o[0],l=c.childNodes,f=r.index,d=r.removed,p=r.addedCount,v=d.length;if(v>0)for(var g=0;v>g;++g)i=u.indexOf(d[g]),i>=0&&(s=l[i],a(s).removeClass($),n.hasCheckbox()&&e(t(s),!1));if(p>0)for(var y=0;p>y;++y)i=u.indexOf(h.at(f+y)),s=l[i],a(s).addClass($),n.hasCheckbox()&&e(t(s),!0);if(p>0||v>0){var m=p-v;if(m&&n.hasCheckbox()){var b=h.length,C=n.$thead[0],x=n.$tfoot[0],k=C.childNodes[0].childNodes[0],w=k.childNodes[0],E=k.childNodes[1],N=x.childNodes[0].childNodes[0],A=N.childNodes[1],S=N.childNodes[0];A.innerHTML=w.innerHTML=b,A.title=w.title=b,S.checked=E.checked=n.isSelected(),S.indeterminate=E.indeterminate=b>0&&u.length!==b}n.dispatchEvent("selectionchanged",function(){return{selection:this.$selection.toArray()}})}return this}};return n}(),P=function(){var t=N.toPx,e=N.fromPx,n=function(t){var e=t||[];return i.isArray(e)||(e=[e]),i.map(e,function(t){var e=t.charAt(0);return e!==k&&e!==w?k+t:t})},r=function(t){var e="$"+t,n=this.$table;this[e]=a(A.byTagName(t,n[0])),this[e].length||(this[e]=a(A[t]())),n.append(this[e][0])},o=function(t){return R.on(this,t)},u=function(t){return W.on(this,t)},h=function(t){var e=this.options.events[t];e&&this.addEventListener(t.slice(2),this.options.events[t])},l=function(t,n){if(!(this instanceof l))return new l(t,n);var s=n=n||{},f=l.options;i.forEach(["events","selection","size"],function(t){var e=s[t];(i.isObject(e)||i.isUndefined(e))&&(s[t]=i.defaults(e||{},f[t]))}),this.options=i.defaults(s,f),s.size={width:e(s.size.width),height:e(s.size.height)},s.scrollable=s.scrollable||!!s.size.height;var d=this.isSelectable(),$=this.isSortable(),g=s.scrollable;this.$table=a(t),this.$data=new T(s.data,{key:s.key,model:s.model}),$||i.forEach(s.columns,function(t){t.sortable=!1}),this.$columns=new T(s.columns,{key:"id",model:F}),this.$sortBy=[],this.$table.addClass(c),d&&this.$table.addClass(v),g&&this.$table.addClass(p),i.forEach(["thead","tbody","tfoot"],r,this),(d||$)&&(this.$thead.on("click",i.bind(M.onClickThead,this)),this.$tfoot.on("click",i.bind(M.onClickTfoot,this))),this.$data.observe(o,this),d&&(this.$selection=new T([],this.$data.options()),this.$tbody.on("click",i.bind(M.onClickTbody,this)),this.$selection.observe(u,this)),this.$bus=new S,i.forEach(i.keys(s.events),h,this),(s.size.height||s.size.width)&&this.assignWidth(),this.renderHeader().renderFooter().sortBy(n.sortBy,!1).renderBody(),this.dispatchEvent("initialized")};return l.create=function(t,e){return new l(t,e)},l.prototype={data:function(){return this.$data},columns:function(){return this.$columns},selection:function(){return this.$selection},isSortable:function(){return this.options.sortable},isSelectable:function(){var t=this.options.selection;return t&&t.enable},hasCheckbox:function(){return this.isSelectable()&&this.options.selection.checkbox},isSelected:function(t){if(!this.isSelectable())return!1;if(t)return this.$selection.contains(t);var e=this.$data.length,n=this.$selection.length;return e>0&&e===n},render:function(){return this.renderHeader().renderFooter().renderBody()},assignWidth:function(){var e=this.options.size,n=e.width;if(e.height){var r=t(e.width);this.$table.css({width:r,maxWidth:r,minWidth:r}),this.$tbody.css({maxHeight:t(e.height)}),n-=A.scrollbarWidth(),this.hasCheckbox()&&(n-=30)}var i=0,s=0;this.$columns.forEach(function(t){var e=t.width;e&&(i+=e,++s)});var o=this.$columns.length,a=o-s,u=0,h=0;if(a){var c=(n-i)/a;u=Math.floor(c),h=c-u}var l=0;return this.$columns.forEach(function(t){var e=t.width,n=e||0;n||(l+=h,l>=1?(n=u+1,l--):n=u),n!==e&&t.updateWidth(n)}),this},renderHeader:function(){var t=L.theadRow(this);return this.$thead.empty().append(t),this},renderFooter:function(){var t=L.tfootRow(this);return this.$tfoot.empty().append(t),this},renderBody:function(t){var e=null==t?this.options.async:t,n=this,r=i.once(function(){n.$tbody.empty()}),s=function(t,e){var i=L.tbodyRows(n,t,e);r(),n.$tbody.append(i)},o=function(){n.$data.clearChanges(),n.dispatchEvent("rendered",function(){return{data:this.$data,nodes:i.toArray(this.$tbody[0].childNodes)}}),n=r=s=o=null};return e?N.asyncTask(this.$data.split(200),10,s,o):(s(this.$data,0),o()),this},select:function(){return this.$selection.length!==this.$data.length&&this.$selection.add(this.$data.toArray()),this},deselect:function(){return this.$selection.isEmpty()||this.$selection.clear(),this},sortBy:function(t,e){var r=n(t);if(this.$sortBy===r||this.$sortBy.join()===r.join())return this;this.$sortBy=r;var o=this.$thead.children().eq(0).children(),a=this.$tfoot.children().eq(0).children();o.removeClass(f+" "+d).removeAttr(C),a.removeClass(f+" "+d).removeAttr(C);var u=this.$columns,h=this.hasCheckbox(),c=i.map(this.$sortBy,function(t){var e,n=t.charAt(0),r=t.substr(1),i=n===k,c=u.indexOf(r),l=h?c+1:c;return c>=0?(e=u.at(c),e.asc=i,o.eq(l).addClass(i?f:d).attr(C,n),a.eq(l).addClass(i?f:d).attr(C,n)):e={},{parser:e.$parser||s(t),fn:e.$comparator||z.$auto,desc:!i}});return this.$data.sort(j(c)),e!==!1&&this.renderBody(),this.dispatchEvent("sorted")},dispatchEvent:function(t,e){return this.$bus.dispatchEvent(this,t,e),this},addEventListener:function(t,e){return this.$bus.addEventListener(t,e),this},removeEventListener:function(t,e){return this.$bus.removeEventListener(t,e),this},destroy:function(){this.$thead.off(),this.$tfoot.off(),this.$tbody.off(),this.$data.unobserve(),this.$selection.unobserve(),this.$bus.clear(),N.destroy(this)}},l.options={key:"id",async:!1,scrollable:!1,sortable:!0,selection:{enable:!0,checkbox:!0,multi:!1},size:{width:null,height:null},events:{}},i.forEach(["onInitialized","onRendered","onDataSpliced","onDataUpdated","onSelectionChanged","onSorted"],function(t){l.options.events[t]=null}),l}(),D={Grid:P,addRenderer:function(t,e){return O[t]=e,D},addComparator:function(t,e){return z[t]=e,D}};u.provider("Waffle",function(){this.$get=function(){return D},i.forEach(i.keys(D),function(t){this[t]=D[t]},this)}),u.directive("waffle",["$parse","$rootScope",function(t,e){return{restrict:"AE",replace:!1,require:"?ngModel",template:"<table><thead></thead><tbody></tbody></table>",link:function(n,r,s,o){var a=i.noop,u=function(t){var r=t||a;return e.$$phase?r():n.$apply(r)},h=r;"table"!==h[0].tagName.toLowerCase()&&(h=h.children().eq(0));var c=function(t){return t?function(){var e=arguments,n=this,r=u(function(){return t.apply(n,e)});return n=e=null,r}:void 0},l=function(){var e=s.waffleOptions||s.waffleGrid;return t(e)(n)||{}}(),f=t(s.waffleGrid).assign||i.noop,d=l.events=l.events||{};i.forEach(i.keys(P.options.events),function(t){var e=d[t]=c(d[t]);s[t]&&(d[t]=c(function(r){e&&e.call(this,r),n.$eval(s[t],{$event:r})}))});var p=P.create(h,l);f(n,p),p.addEventListener("dataspliced",function(){u()}),p.isSelectable()&&(p.addEventListener("selectionchanged",function(t){u(function(){o&&o.$setViewValue(t.details.selection)})}),o&&(o.$formatters.push(function(t){return p.selection().reset(t),t}),o.$isEmpty=function(t){return!t||!t.length})),n.$on("$destroy",function(){p.destroy(),p=l=f=h=null})}}}])}(window,document,window.angular,void 0);