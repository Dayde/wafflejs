!function(t,e,n,r){"use strict";var i=function(){var t=Array.prototype,e=t.slice,n=Object.prototype,i=Object.keys,o=n.hasOwnProperty,s=n.toString,a=Function.prototype.bind,u=function(t){return c.isString(t)?function(e){return e[t]}:t},h=function(t){return function(e,n,r){for(var i={},o=u(n),s=0,a=e.length;a>s;++s){var h=o.call(r,e[s],s,e);t(i,e[s],h)}return i}},c={};return c.isNull=function(t){return null===t},c.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"===s.call(t)},c.bind=function(t,e){return a?t.bind(e):function(){return t.apply(e,arguments)}},c.toArray=function(t){return c.map(t,function(t){return t})},c.isNaN=function(t){return c.isNumber(t)&&t!==+t},c.once=function(t){var e,n=!1;return function(){return n||(n=!0,e=t.apply(this,arguments),t=null),e}},c.defaults=function(t,e){return c.forEach(c.keys(e),function(n){c.isUndefined(t[n])&&(t[n]=e[n])}),t},c.result=function(t,e){var n=t[e];return c.isFunction(n)?n.call(t):n},c.has=function(t,e){return o.call(t,e)},c.size=function(t){return t.length},c.first=function(t,n){return null==n?t[0]:e.call(t,0,n)},c.last=function(t,n){return null==n?t[t.length-1]:e.call(t,t.length-n,t.length)},c.rest=function(t,n){var r=arguments.length>1?n:1;return e.call(t,r,t.length)},c.initial=function(t,n){var r=t.length,i=arguments.length>1?r-n:r-1;return e.call(t,0,i)},c.indexOf=function(t,e){for(var n=0,r=t.length;r>n;++n)if(t[n]===e)return n;return-1},c.lastIndexOf=function(t,e){for(var n=t.length-1;n>=0;--n)if(t[n]===e)return n;return-1},c.contains=function(t,e){return c.indexOf(t,e)>=0},c.keys=function(t){if(!c.isObject(t))return[];if(i)return i(t);var e=[];for(var n in t)c.has(t,n)&&e.push(n);return e},c.functions=function(t){var e=[];for(var n in t)c.isFunction(t[n])&&e.push(n);return e.sort()},c.map=function(t,e,n){for(var r=[],i=0,o=t.length;o>i;++i)r[i]=e.call(n,t[i],i,t);return r},c.every=function(t,e,n){for(var r=0,i=t.length;i>r;++r)if(!e.call(n,t[r],r,t))return!1;return!0},c.some=function(t,e,n){for(var r=0,i=t.length;i>r;++r)if(e.call(n,t[r],r,t))return!0;return!1},c.filter=function(t,e,n){for(var r=[],i=0,o=t.length;o>i;++i)e.call(n,t[i],i,t)&&r.push(t[i]);return r},c.reject=function(t,e,n){for(var r=[],i=0,o=t.length;o>i;++i)e.call(n,t[i],i,t)||r.push(t[i]);return r},c.reduce=function(t,e,n,r){for(var i=arguments.length,o=i>=3?n:t[0],s=t.length,a=i>=3?0:1;s>a;++a)o=e.call(r,o,t[a],a,t);return o},c.reduceRight=function(t,e,n,r){for(var i=arguments.length,o=t.length-1,s=i>=3?n:t[o],a=i>=3?o:o-1;a>=0;--a)s=e.call(r,s,t[a],a,t);return s},c.find=function(t,e,n){for(var i=0,o=t.length;o>i;++i)if(e.call(n,t[i],i,t))return t[i];return r},c.partition=function(t,e){for(var n=[],r=[],i=0,o=t.length;o>i;++i)e.call(null,t[i],i,t)?n.push(t[i]):r.push(t[i]);return[n,r]},c.memoize=function(t,e){var n=function(r){var i=n.cache,o=e?e.apply(this,arguments):r;return c.has(i,o)||(i[o]=t.apply(this,arguments)),i[o]};return n.cache={},n},c.debounce=function(t,e,n){var r;return function(){var i=this,o=arguments,s=function(){r=null,n||t.apply(i,o)},a=n&&!r;r&&(clearTimeout(r),r=null),r=setTimeout(s,e),a&&t.apply(i,o)}},c.now=Date.now||function(){return(new Date).getTime()},c.indexBy=h(function(t,e,n){t[n]=e}),c.groupBy=h(function(t,e,n){(t[n]=t[n]||[]).push(e)}),c.countBy=h(function(t,e,n){t[n]=(t[n]||0)+1}),c}();n.forEach(["noop","identity","forEach","isUndefined","isFunction","isObject","isArray","isNumber","isDate","isElement","isString","extend"],function(t){i[t]=n[t]}),i.clone=n.copy;var o,s,a,u=n.element,h={toJson:n.toJson,fromJson:n.fromJson},c=n.module("waffle",[]);c.run(["$injector","$log","$filter",function(t,e,n){o=t.get("$parse"),a=t.get("$sniffer");try{s=t.get("$sanitize")}catch(r){e.warn("Module ngSanitize is not available, you should add this module to avoid xss injection"),s=i.identity}var u=M.$get;M.$get=function(t){return u(t)||n(t)}}]);var l=function(){var t="key_",e=function(e){return t+e},n=function(){return this instanceof n?void(this.$o={}):new n};return n.prototype={clear:function(){this.$o={}},put:function(t,n){return this.$o[e(t)]=n,this},get:function(t){return this.$o[e(t)]},remove:function(t){return delete this.$o[e(t)],this},contains:function(t){return i.has(this.$o,e(t))}},n}(),d="waffle-",f="waffle-grid",p=d+"sortable",v=p+"-asc",g=p+"-desc",$=d+"draggable",b=$+"-drag",m=$+"-over",y=d+"fixedheader",C=d+"selectable",x=d+"selected",E=d+"checkbox",k="data-waffle-",N=k+"id",w=k+"sortable",S=k+"order",A=k+"idx",T="+",D="-",z="tbody",B="thead",O="tfoot",P="table",j={msie:function(){return e.documentMode},endWith:function(t,e){return!!t&&t.slice(t.length-e.length)===e},isPx:function(t){return j.endWith(t,"px")},isPercentage:function(t){return j.endWith(t,"%")},fromPercentage:function(t){return i.isString(t)?Number(t.replace("%","")):t},toPx:function(t){return i.isNumber(t)?t+"px":t},fromPx:function(t){return i.isString(t)?Number(t.replace("px","")):t},capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},parse:function(t){try{return h.fromJson(t)}catch(e){if("false"===t)return!1;if("true"===t)return!0;var n=Number(t);return i.isNaN(n)?t:n}},destroy:function(t){for(var e in t)i.has(t,e)&&(t[e]=null)},toSpinalCase:function(t){for(var e="",n=0,r=t.length;r>n;++n){var i=t.charAt(n);e+=i.toLowerCase()===i?i:"-"+i.toLowerCase()}return e},asyncTask:function(t,e,n,r){var i=0,o=function(){if(t.length>0){var s=t.shift();n(s,i),i+=s.length,t.length>0?setTimeout(o,e):(r(),o=null)}};setTimeout(o)}},R=function(){var t=function(){var t=e.createElement("div");t.style.width="100px",t.style.height="100px",t.style.overflow="scroll",t.style.position="absolute",t.style.top="-9999px",e.body.appendChild(t);var n=t.offsetWidth-t.clientWidth;return e.body.removeChild(t),n},n=function(){return"body"},r={create:function(t){return e.createElement(t)},byId:function(t){var n=e.getElementById(t);return n?[n]:[]},byTagName:function(t,n){return(n||e).getElementsByTagName(t)},createFragment:function(){return e.createDocumentFragment()},findParent:function(t,e){for(;t&&t.tagName!==e;)t=t.parentNode;return t},scrollbarWidth:i.memoize(t,n)};return i.forEach(["tr","td","th",z,B,O,"input","select","option","span"],function(t){r[t]=function(){return this.create(t)}}),i.forEach(["text","checkbox","number","email","url","date","time","datetime"],function(t){var e="input"+j.capitalize(t);r[e]=function(){var e=this.input();return e.setAttribute("type",t),e}}),r}(),W=function(){var t=function(t,e,n){return t.replaceChild(n,e)},e=function(t,e){t.nodeValue!==e.nodeValue&&(t.nodeValue=e.nodeValue)},n=function(t,e){for(;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)},r=function(t,e){o.mergeAttributes(t,e);var r=t.childNodes,i=e.childNodes;if(r.length!==i.length)n(t,e);else for(var s=0,a=r.length;a>s;++s)o.mergeNodes(t,r[s],i[s])},o={mergeNodes:function(n,i,o){var s=i.nodeType,a=o.nodeType,u=i.tagName,h=o.tagName,c=i;return s!==a||u!==h?(t(n,i,o),c=o):3===s?e(i,o):r(i,o),c},mergeAttributes:function(t,e){var n=i.indexBy(t.attributes,"name"),r=i.indexBy(e.attributes,"name");i.forEach(i.keys(r),function(e){var i=n[e]||null,o=i?i.value:null,s=r[e].value;o!==s&&t.setAttribute(e,s),i&&delete n[e]}),i.forEach(i.keys(n),function(e){t.removeAttribute(e)})}};return o}(),F=function(){var t=i.noop,e=function(t,e,n){this.type=t,this.bubbles=!1,this.cancelable=!1,this.details=n,this.timeStamp=i.now(),this.target=e,this.currentTarget=e,this.srcElement=e};e.prototype={preventDefault:t,stopPropagation:t,stopImmediatePropagation:t};var n=function(t){return t.toLowerCase()},r=function(){this.$events={}};return r.prototype={addEventListener:function(t,e){var r=n(t),i=this.$events,o=i[r]=i[r]||[];o.push(e)},removeEventListener:function(t,e){var r=n(t),o=this.$events[r];o&&o.length&&(this.$events[r]=i.reject(o,function(t){return t===e}))},dispatchEvent:function(t,r,o){r=n(r);var s=this.$events[r];if(s&&s.length)for(var a=new e(r,t,i.isFunction(o)?o.call(t):o),u=0,h=s.length;h>u;++u)try{s[u].call(t,a)}catch(c){}},clear:function(){this.$events={}}},r}(),L=function(){var t=function(t){return t&&t.length>0},e=function(){var e=this.$$changes,n=this.$$observers;if(t(e)&&t(n)){var r=e.splice(0,e.length);i.forEach(n,function(t){t.callback.call(t.ctx,r)})}},n={observe:function(t,e){return this.$$observers=this.$$observers||[],this.$$observers.push({ctx:e||null,callback:t}),this},unobserve:function(e,n){if(t(this.$$observers))if(0===arguments.length)this.$$observers=[];else{var r=n||null;this.$$observers=i.reject(this.$$observers,function(t){return t.ctx===r&&e===t.callback})}return this},trigger:function(t){return i.isArray(t)||(t=[t]),this.$$changes=this.$$changes||[],this.$$changes.push.apply(this.$$changes,t),setTimeout(i.bind(e,this)),this},pendingChanges:function(){return this.$$changes||[]},clearChanges:function(){return this.$$changes&&this.$$changes.splice(0,this.$$changes.length),this}};return n}(),U=function(){var t=Array.prototype,e=function(){try{var e={};return e[0]=1,!!t.toString.call(e)}catch(n){return!1}}(),n=function(n){return function(){var r=e?this:i.toArray(this);return t[n].apply(r,arguments)}},s=function(t,e,r){return n(t).apply(e,r)},a=function(t,e){var n=e||{};this.$$map=new l,this.$$model=n.model||Object,this.$$key=n.key||"id",i.isFunction(this.$$key)||(this.$$key=o(this.$$key)),this.length=0,t&&t.length&&this.push.apply(this,t)},u=function(t){return parseInt(Number(t)||0,10)},h="splice",c="update",d=function(t,e,n,r,i){return{type:t,removed:e,index:n,addedCount:r,object:i}},f=function(t,e){delete t[e]},p=function(t,e){t.$$map.remove(e)},v=function(t,e){var n=t.$$key(e),r=t.$$map.get(n),i=r?r.idx:null;null!=i&&(f(t,i),p(t,n))},g=function(t,e){if(!i.isObject(e))throw new Error("Waffle collections are not array, only object are allowed");return e instanceof t.$$model?e:new t.$$model(e)},$=function(t,e,n,r){if(t[n]=e,null!=e){var i=arguments.length,o=3===i?t.$$key(e):r,s=t.$$map.get(o)||{};s.idx=n,t.$$map.put(o,s)}},b=function(t,e){var n=t.indexOf(e);return t[n]=e,d(c,[],n,0,t)},m=function(t,e,n){var r=t.at(n),i=t.at(e);$(t,i,n),$(t,r,e)},y=function(t,e,n){for(var r=Math.abs(n),i=t.length-1;i>=e;--i)m(t,i,i+r);t.length+=r},C=function(t,e,n){for(var r=Math.abs(n),i=t.length,o=i-r,s=e+r,a=[],u=s;i>u;++u)m(t,u,u-r);for(var h=o;i>h;++h){var c=t.at(h);a.unshift(c),v(t,c)}return t.length=o,a},x=function(t,e){for(var n,r=t.$$sortFn,o=t.length,s=e.length,a=o+s,u=[],c=o-1,l=s-1,f=a-1;f>=0;--f)if(0>c||r(t[c],e[l])<0){if($(t,e[l--],f),n=i.first(u),n&&n.index===f+1?(n.index=f,n.addedCount++):(n=d(h,[],f,1,t),u.unshift(n)),0>l)break}else $(t,t[c--],f);return t.length=a,u};return a.prototype={options:function(){return{model:this.$$model,key:this.$$key}},at:function(t){return this[t]},byKey:function(t){var e=this.indexOf(t);return e>=0?this.at(e):r},indexOf:function(t){var e=i.isObject(t)?this.$$key(t):t;return this.$$map.contains(e)?this.$$map.get(e).idx:-1},contains:function(t){return this.indexOf(t)>=0},findIndex:function(t,e){for(var n=0,r=this.length;r>n;++n)if(t.call(e,this.at(n),n,this))return n;return-1},add:function(t,e){var n=null==e?this.length:e,r=[n,0].concat(t);return this.splice.apply(this,r),this.length},remove:function(t,e){if(i.isNumber(t))return this.splice.call(this,t,e||this.length);if(i.isArray(t)){var n=this.$$key,r=i.indexBy(t,n);return this.remove(function(t){return!!r[n(t)]})}for(var o=t,s=e,a=0,u=null,c=[],l=[],v=0,g=this.length;g>v;++v){var b=this.at(v),m=this.$$key(b);o.call(s,b,v)?(f(this,v),p(this,m),u===v-1?i.last(c).removed.push(b):c.push(d(h,[b],v,0,this)),l.push(b),u=v):(a!==v&&(f(this,v),p(this,m),$(this,b,a,m)),a++)}return this.length-=l.length,c.length>0&&this.trigger(c),l},triggerUpdate:function(t){return this.trigger([d(c,[],t,0,this)]),this},replace:function(t){var e=[0,0].concat(t);return this.splice.apply(this,e),this},push:function(){return this.add.call(this,i.toArray(arguments))},unshift:function(){return this.add.call(this,i.toArray(arguments),0)},pop:function(){return this.remove(this.length-1,1)[0]},shift:function(){return this.remove(0,1)[0]},toggle:function(t){var e=this.indexOf(t);return e>=0?this.remove(e,1):this.push(t)},clear:function(){if(this.length>0){for(var t=[],e=0,n=this.length;n>e;++e)t[e]=this.at(e),f(this,e);this.$$map.clear(),this.length=0,this.trigger(d(h,t,0,0,this))}return this},reset:function(t){var e=this.length,n=t.length,r=this.$$sortFn;r&&t.sort(r),this.$$map.clear();for(var i=[],o=t.length,s=0;n>s;++s)e>s&&i.push(this.at(s)),$(this,g(this,t[s]),s);for(;e>s;++s)i.push(this.at(s)),f(this,s);return this.length=n,this.trigger([d(h,i,0,o,this)]),this},isEmpty:function(){return 0===this.length},concat:function(){var e=t.concat.apply(this.toArray(),arguments);return new a(e,this.options())},slice:function(){var t=s("slice",this,arguments);return new a(t,this.options())},splice:function(t,e){var n=this.$$sortFn,r=this.length,o=i.rest(arguments,2),s=function(t){return g(this,t)},a=i.map(o,s,this),c=u(t);c=c>=0?Math.min(r,c):Math.max(r+c,0);var l=Math.min(Math.max(u(e)||0,0),r-c),f=[];if(l>0){for(var p=0;l>p;++p)f.push(this[p+c]);C(this,c,l)}var v,m=i.groupBy(a,this.contains,this),E=m[!0]||[],k=m[!1]||[],N=k.length,w=E.length;if(N>0)if(n)k.sort(n),v=x(this,k);else{y(this,c,N);for(var S=0;N>S;++S)$(this,k[S],c+S);v=[d(h,f,c,N,this)]}else v=[];if(f.length>0){var A=i.find(v,function(t){return t.index===c});A?A.removed=f:v.unshift(d(h,f,c,0,this))}var T=[];if(w>0){n&&E.sort(n);for(var D=0;w>D;++D)T.push(b(this,E[D]))}var z=v.concat(T);return z.length>0&&this.trigger(z),f},reverse:function(){if(this.$$sortFn)return this;for(var t=this.length,e=Math.floor(t/2),n=[],r=[],i=0,o=t-1;e>i;++i,--o)m(this,i,o),n.push(d(c,[],i,0,this)),r.unshift(d(c,[],o,0,this));var s=n.concat(r);return s.length&&this.trigger(s),this},split:function(t){for(var e=t||20,n=[],r=[],i=0,o=this.length;o>i;++i)r.push(this.at(i)),r.length===e&&(n.push(r),r=[]);return r.length>0&&n.push(r),n},toJSON:function(){return JSON.stringify(this.toArray())},sort:function(t){return this.$$sortFn=t,this.reset(this.toArray()).clearChanges()},pluck:function(t){var e=o(t);return this.map(function(t){return e(t)})}},a.prototype.lastIndexOf=a.prototype.indexOf,i.extend(a.prototype,L),i.forEach(["size","first","last","initial","rest","partition","forEach","map","every","some","reduce","reduceRight","filter","reject","find","toArray"],function(t){i[t]&&(a.prototype[t]=function(){var e=[this].concat(i.toArray(arguments));return i[t].apply(i,e)})}),i.forEach(["countBy","groupBy","indexBy"],function(t){a.prototype[t]=function(e,n){if(i.isString(e)){var r=o(e);e=function(t){return r(t)}}return i[t].call(i,this,e,n)}}),i.forEach(["toString","toLocaleString","join"],function(t){a.prototype[t]=n(t)}),a}(),M=function(){var t=function(t){return(null==t?"":t).toString()},e={$identity:i.identity,$empty:function(){return""},$lowercase:function(e){return t(e).toLowerCase()},$uppercase:function(e){return t(e).toUpperCase()},$capitalize:function(e){return j.capitalize(t(e))},$get:function(t){return e[t]}};return e}(),I={$string:function(t,e){var n=null==t?"":String(t),r=null==e?"":String(e);return n.localeCompare(r)},$number:function(t,e){var n=null==t?0:Number(t),r=null==e?0:Number(e);return n-r},$boolean:function(t,e){var n="false"===t?0:Boolean(t)?1:0,r="false"===e?0:Boolean(e)?1:0;return n-r},$date:function(t,e){var n=i.isDate(t)?t.getTime():new Date(null==t?0:t).getTime(),r=i.isDate(e)?e.getTime():new Date(null==e?0:e).getTime();return n-r},$auto:function(t,e){if(t===e||null==t&&null==e)return 0;var n=i.find(["Number","Boolean","Date","String"],function(n){var r=i["is"+n];return r(t)||r(e)});return n?I["$"+n.toLowerCase()](t,e):e>t?-1:1},$get:function(t){return I[t]}},H=function(t){return i.isArray(t)||(t=[t]),function(e,n){if(e===n||null==e&&null==n)return 0;for(var r=0,i=t.length;i>r;++r){var o=t[r],s=o.parser(e),a=o.parser(n),u=o.fn.call(I,s,a);if(u)return o.desc?-1*u:u}return 0}},V=function(){var t={".":"-","(":"",")":"","[":"-","]":"-","'":"",'"':""},e=i.isUndefined,n="$identity",r="$auto",a=j.fromPx,u=j.toPx,h=function(t,e,n){return i.isString(t)&&(t=e.$get(t)),i.isFunction(t)||(t=e.$get(n)),t},c=function(a){i.isString(a)&&(a={id:a});var u=a.escape,c=a.sortable;this.id=a.id,this.title=a.title||"",this.field=a.field||this.id,this.css=a.css||"",this.escape=e(u)?!0:!!u,this.width=a.width,this.sortable=e(c)?!0:!!c,this.draggable=!!a.draggable,this.asc=e(a.asc)?null:!!a.asc;var l=a.editable===!0?{}:a.editable;if(l&&(l=i.defaults(l,{type:"text",css:null})),this.editable=l,!this.css)for(var d=0,f=this.id.length;f>d;++d){var p=this.id.charAt(d),v=t[p];this.css+=null!=v?v:p}u&&(this.title=s(this.title));var g=a.renderer||n,$=i.isArray(g)?g:[g];this.$renderer=i.map($,function(t){return h(t,M,n)}),this.$comparator=h(a.comparator,I,r),this.$parser=o(this.field)};return c.prototype={cssClasses:function(){var t=[this.css];this.sortable&&t.push(p),this.draggable&&t.push($);var e=this.asc;return null!=e&&t.push(e?v:g),t.join(" ")},attributes:function(t,e){var n={};if(n[N]=this.id,e){if(this.sortable){n[w]=!0;var r=this.asc;null!=r&&(n[S]=r?T:D)}this.draggable&&(n.draggable=!0)}return n},styles:function(){var t={},e=u(this.computedWidth);return e&&(t.width=e,t.maxWidth=e,t.minWidth=e),t},updateWidth:function(t){return this.width=a(t),this},render:function(t){var e=this.field,n=this.value(t),r=i.reduce(this.$renderer,function(n,r){return r.call(M,n,t,e)},n);return null==r?"":this.escape?s(r):r},value:function(t,e){var n=this.$parser;return 2===arguments.length?(n.assign(t,e),this):null==t?"":n(t)}},c}(),q=function(){var t="THEAD",e="TFOOT",n="TBODY",r="TH",o="TR",s="INPUT",a=function(t){return t.tagName===s&&"checkbox"===t.getAttribute("type")},h=function(t){return!!t.getAttribute("draggable")},c=function(t,e){var n=R.findParent(t,e.tagName);return n===e},l={number:function(t){return Number(t)},checkbox:function(t){return!!t}},d=function(t,e){var n=t.target,o=R.findParent(t.target,r);if(n.tagName!==e)if(this.isSelectable()&&a(n))n.checked?this.select():this.deselect();else if(o&&o.getAttribute(w)){var s,u=o.getAttribute(N),h=o.getAttribute(S)||D,c=h===T?D:T,l=c+u;if(t.shiftKey){var d=h+u;s=i.reject(this.$sortBy,function(t){return t===d})}else s=[];s.push(l),this.sortBy(s)}},f={onClickThead:function(e){return d.call(this,e,t)},onClickTfoot:function(t){return d.call(this,t,e)},onClickTbody:function(t){if(this.isSelectable()&&t.target.tagName!==n){var e=R.findParent(t.target,o),r=e.getAttribute(A),i=this.$data.at(r),s=this.$selection;if(this.options.selection.multi)if(t.shiftKey){for(var a=parseFloat(r),u=parseFloat(this.$$selectAnchor),h=Math.min(a,u),c=Math.max(a,u),l=[],d=h;c>=d;++d){var f=this.$data.at(d);s.contains(f)||l.push(f)}l.length>0&&s.push.apply(s,l)}else s.toggle(i),this.$$selectAnchor=r;else{var p=s.indexOf(i);p>=0?s.remove(p,1):s.reset([i])}}},onInputTbody:function(t){var e=t.target,n=e.getAttribute(N),r=n?this.$columns.byKey(n):null;if(r&&r.editable){var o=R.findParent(e,"TR");if(o){var s=r.editable.type,a=l[s]||i.identity,h=Number(o.getAttribute(A)),c=this.$data,d=c.at(h),f=r.value(d),p=a(u(e).val());f!==p&&(r.value(d,p),this.dispatchEvent("datachanged",{index:h,object:d,oldValue:f,newValue:p}),c.triggerUpdate(h))}}},onDragStart:function(t){var e=t.target,n=t.originalEvent||t,r=n.dataTransfer;h(e)&&(u(e).addClass(b),r.effectAllowed="move",r.clearData(),r.setData("Text",e.getAttribute(N)))},onDragEnd:function(t){var e=t.target,n=this.$table[0];u(R.byTagName("th",n)).removeClass(m),h(e)&&c(e,n)&&u(t.target).removeClass(b)},onDragOver:function(t){var e=t.target;if(h(e)&&c(e,this.$table[0])){var n=t.originalEvent||t,r=n.dataTransfer;return r.dropEffect="move",t.preventDefault(),!1}},onDragEnter:function(t){var e=t.target;return h(e)&&c(e,this.$table[0])?(u(e).addClass(m),t.preventDefault(),!1):void 0},onDragLeave:function(t){var e=t.target;return h(e)&&c(e,this.$table[0])?(u(e).removeClass(m),t.preventDefault(),!1):void 0},onDragDrop:function(t){var e=t.target;if(h(e)&&c(e,this.$table[0])){var n=t.originalEvent||t,r=n.dataTransfer,i=r.getData("Text"),o=e.getAttribute(N);if(i!==o){var s=this.$columns,a=s.indexOf(i),l=s.indexOf(o);s.add(s.remove(a,1),l),u(e).removeClass(m)}return t.preventDefault(),!1}},onSelectStart:function(t){var e=t.target;return h(e)?(t.preventDefault(),e.dragDrop(),!1):void 0}};return f}(),J=function(){var e=function(t,e,n,r){t.$$events[r]||(t.$$events[r]=i.bind(q[r],t),t["$"+e].on(n,t.$$events[r]))},n=function(t,e,n,r){t.$$events[r]&&(t["$"+e].off(n,t.$$events[r]),t.$$events[r]=null)},r=function(){var t=a.hasEvent("input")?"input":"keyup";return t+=" change"},o="click",s={bindResize:function(e){if(!e.$$events.onResize){var n=i.bind(e.resize,e);e.$$events.onResize=i.debounce(n,100),u(t).on("resize",e.$$events.onResize)}},bindEdition:function(t){e(t,z,r(),"onInputTbody")},unbindEdition:function(t){n(t,z,r(),"onInputTbody")},bindSelection:function(t){e(t,B,o,"onClickThead"),e(t,O,o,"onClickTfoot"),e(t,z,o,"onClickTbody")},bindSort:function(t){e(t,B,o,"onClickThead"),e(t,O,o,"onClickTfoot")},bindDragDrop:function(t){e(t,P,"dragstart","onDragStart"),e(t,P,"dragover","onDragOver"),e(t,P,"dragend","onDragEnd"),e(t,P,"dragleave","onDragLeave"),e(t,P,"dragenter","onDragEnter"),e(t,P,"drop","onDragDrop"),j.msie()<=9&&e(t,P,"selectstart","onSelectStart")}};return s}(),K=function(){var t="px",e="percent",n="auto",r={};r[t]=function(t){return j.fromPx(t.computedWidth)},r[e]=function(t,e){return j.fromPercentage(t.computedWidth)*e/100},r[n]=function(t,e,n){return e/n};var o={checkbox:function(t){return!!t}},s={computeWidth:function(o,s){var a=o,u=0,h=s.groupBy(function(r){var o=r.computedWidth=i.result(r,"width");return i.isNumber(o)||j.isPx(o)?t:j.isPercentage(o)?e:n});i.forEach([t,e,n],function(t){var e=h[t];if(e){var n=a,o=e.length;i.forEach(e,function(e){var i=r[t](e,n,o);e.computedWidth=i,a-=i,u++})}})},theadRow:function(t){var e=R.tr();return t.hasCheckbox()&&e.appendChild(s.theadCheckboxCell(t)),t.$columns.forEach(function(n,r){e.appendChild(s.theadCell(t,n,r))}),e},theadCell:function(t,e,n){return u(R.th()).addClass(e.cssClasses(n,!0)).css(e.styles(n,!0)).attr(e.attributes(n,!0)).html(e.title)[0]},theadCheckboxCell:function(t){var e=t.$selection.size(),n=t.$data.size(),r=u(R.span()).attr("title",e).html(e),i=u(R.inputCheckbox()).prop("checked",t.isSelected()).prop("indeterminate",e>0&&e!==n);return u(R.th()).addClass(E).append(r[0]).append(i[0])[0]},tfootRow:function(t){var e=R.tr();return t.hasCheckbox()&&e.appendChild(s.tfootCheckboxCell(t)),t.$columns.forEach(function(n,r){e.appendChild(s.tfootCell(t,n,r))}),e},tfootCell:function(t,e,n){return s.theadCell(t,e,n)},tfootCheckboxCell:function(t){var e=s.theadCheckboxCell(t);return e.appendChild(e.childNodes[0]),e},tbodyRows:function(t,e,n){for(var r=R.createFragment(),i=0,o=e.length;o>i;++i)r.appendChild(s.tbodyRow(t,e[i],n+i));return r},tbodyRow:function(t,e,n){var r=u(R.tr());return r.attr(A,n),r.attr(N,t.$data.$$key(e)),t.isSelectable()&&t.$selection.contains(e)&&r.addClass(x),t.hasCheckbox()&&r[0].appendChild(s.tbodyCheckboxCell(t,e)),t.$columns.forEach(function(n,i){r[0].appendChild(s.tbodyCell(t,e,n,i))}),r[0]},tbodyCell:function(t,e,n,r){var i=u(R.td()).addClass(n.cssClasses(r,!1)).css(n.styles(r,!1)).attr(n.attributes(r,!1)),o=n.editable;return o?i.append(s.tbodyControl(n,e)):i.html(n.render(e)),i[0]},tbodyCheckboxCell:function(t,e){var n=u(R.inputCheckbox()).prop("checked",t.isSelected(e));return u(R.td()).addClass(E).append(n[0])[0]},tbodyControl:function(t,e){var n,r=t.editable;"select"===r.type?(n=R.select(),r.options&&i.forEach(r.options,function(t){var e=R.option();e.innerHTML=null!=t.label?t.label:"",null!=t.value&&(e.value=t.value),n.appendChild(e)})):(n=R.input(),n.setAttribute("type",r.type)),n.setAttribute(N,t.id);var s="checkbox"===r.type?"checked":"value",a=o[r.type]||i.identity;return n[s]=a(t.value(e)),r.css&&(n.className=r.css),n}};return s}(),G=function(){var t="px",e="percent",n="auto",r={};r[t]=function(t){return j.fromPx(t)},r[e]=function(t,e){return j.fromPercentage(t)*e/100},r[n]=function(t,e,n){return e/n};var o={resize:function(t){o.applySize(t)},applySize:function(t){var e=t.options.size,r=i.result(e,"width"),s=i.result(e,"height"),a=r&&r!==n,u=s&&s!==n;if(a){var h=j.toPx(r);t.$table.css({width:h,maxWidth:h,minWidth:h})}if(u){var c=j.toPx(s);t.$tbody.css({maxHeight:c})}var l=a?j.fromPx(r):null;l||(l=t.$table[0].offsetWidth),l-=R.scrollbarWidth(),t.hasCheckbox()&&(l-=30);var d=t.$columns,f=o.computeWidth(l,d);if(f.length>0)for(var p=i.indexBy(d.pendingChanges(),function(t){return t.type+"_"+t.index}),v=0,g=f.length;g>v;++v){var $=d.indexOf(f[v]);i.has(p,"update_"+$)||d.triggerUpdate($)}return this},computeWidth:function(o,s){var a=o,u=0,h=new l,c=s.groupBy(function(r){var o=i.result(r,"width");return h.put(r.id,o),i.isNumber(o)||j.isPx(o)?t:j.isPercentage(o)?e:n}),d=[];return i.forEach([t,e,n],function(t){var e=c[t];if(e){var n=a,o=e.length;i.forEach(e,function(e){var i=r[t](h.get(e.id),n,o);i!==e.computedWidth&&(e.computedWidth=i,d.push(e)),a-=i,u++})}}),d}};return o}(),_={on:function(t){return i.forEach(t,function(t){var e="on"+j.capitalize(t.type);_[e].call(this,t)},this),this},onSplice:function(t){var e,n,r,o=this.$tbody,s=o[0],a=s.childNodes,u=t.index,h=t.addedCount,c=t.object,l=t.removed,d=l.length;if(d>0){if(0===u&&d===a.length)e=i.toArray(a),o.empty();else{e=[];for(var f=0;d>f;++f)e.push(s.removeChild(a[u]))}var p=this.$selection;p&&p.length>0&&p.remove(l)}if(h>0){n=[],r=[];for(var v=R.createFragment(),g=0;h>g;++g){var $=g+u,b=c.at($),m=K.tbodyRow(this,b,$);n.push(m),r.push(b),v.appendChild(m)}u>0?o.children().eq(u-1).after(v):o.prepend(v)}if(e||n){for(var y=u+h,C=a.length;C>y;++y)a[y].setAttribute(A,y);this.dispatchEvent("dataspliced",{added:r||[],addedNodes:n||[],removedNodes:e||[],removed:l,index:u})}return this},onUpdate:function(t){var e=t.index,n=this.$data.at(e),r=this.$tbody[0],i=r.childNodes[e],o=K.tbodyRow(this,n,e),s=W.mergeNodes(r,i,o);return this.dispatchEvent("dataupdated",{index:e,oldNode:i,newNode:s}),this}},Y=function(){var t=function(t){return t.getAttribute(N)},e=function(e,n){for(var r=[],o=e.childNodes,s=0,a=o.length;a>s;++s)for(var u=o[s],h=i.indexBy(u.childNodes,t),c=0,l=n.length;l>c;++c){var d=h[n[c].id];d&&r.push(u.removeChild(d))}return r},n=function(t,e,n){return t.insertBefore(e,t.childNodes[n]||null)},r={tbody:function(t,e,n){return K.tbodyCell(this,this.$data.at(n),t,e)},thead:function(t,e){return K.theadCell(this,t,e)},tfoot:function(t,e){return K.tfootCell(this,t,e)}},o=function(t,e,n){return function(i,o){var s=i.childNodes[n],a=r[t].call(this,e,n,o),u=W.mergeNodes(i,s,a);return{oldNode:s,newNode:u}}},s=function(t,e){e.draggable=!!e.draggable||!!t.isDraggable(),t.isSortable()||(e.sortable=!1)},a={on:function(t){return i.forEach(t,function(t){var e="on"+j.capitalize(t.type);a[e].call(this,t)},this),this},onSplice:function(r){var o,a,u,h,c,l=this.$thead[0],d=this.$tbody[0],f=this.$tfoot[0],p=this.hasCheckbox(),v=r.index,g=r.addedCount,$=r.removed,b=[],m=[],y=[],C=this.$data,x=this.$columns,E=$.length,k=E>0||g>0;k&&this.isResizable()&&this.resize(),E>0&&(b.push.apply(b,e(l,$)),y.push.apply(y,e(f,$)),m.push.apply(m,e(d,$)));var w=[],S=[],A=[];if(g>0){for(o=0;g>o;++o){u=v+o;var T=x.at(u);s(this,T);var D=K.theadCell(this,T,u),z=K.tfootCell(this,T,u);h=l.childNodes[0],w.push(n(h,D,p?u+1:u)),h=f.childNodes[0],A.push(n(h,z,p?u+1:u))}for(a=0,c=d.childNodes.length;c>a;++a){h=d.childNodes[a];var B=i.indexBy(h.childNodes,t),O=h.getAttribute(N),P=C.byKey(O);for(o=0;g>o;++o){u=v+o;var j=x.at(u),R=j.id;B[R]&&h.removeChild(B[R]);var W=K.tbodyCell(this,P,x.at(u),u);S.push(n(h,W,p?u+1:u))}}}if(k){var F=this.isEditable();g>0&&F?J.bindEdition(this):E>0&&!F&&J.unbindEdition(this),this.dispatchEvent("columnsspliced",{index:v,removedNodes:{thead:b,tbody:m,tfoot:y},addedNodes:{thead:w,tbody:S,tfoot:A}})}return this},onUpdate:function(t){var e=t.index,n=this.hasCheckbox()?e+1:e,r=this.$columns.at(e);s(this,r);var a=function(t){var e=[[],[]],s=this["$"+t][0].childNodes,a=o.call(this,t,r,n),u=function(t,e,n){var r=a.call(this,e,n);return t[0].push(r.oldNode),t[1].push(r.newNode),t};return i.reduce(s,u,e,this)},u=i.map(["thead","tfoot","tbody"],a,this);return r.editable?J.bindEdition(this):this.isEditable()||J.unbindEdition(this),this.dispatchEvent("columnsupdated",{index:e,oldNodes:{thead:u[0][0],tfoot:u[1][0],tbody:u[2][0]},newNodes:{thead:u[0][1],tfoot:u[1][1],tbody:u[2][1]}}),this}};return a}(),Q=function(){var t=function(t){return t.childNodes[0].childNodes[0]},e=function(t,e){t.checked=e},n={on:function(t){return i.forEach(t,function(t){var e="on"+j.capitalize(t.type),n=Q[e];n&&n.call(this,t)},this),this},onSplice:function(n){var r,i,o=this.$tbody,s=this.$data,a=n.object,h=o[0],c=h.childNodes,l=n.index,d=n.removed,f=n.addedCount,p=d.length;if(p>0)for(var v=0;p>v;++v)r=s.indexOf(d[v]),r>=0&&(i=c[r],u(i).removeClass(x),this.hasCheckbox()&&e(t(i),!1));if(f>0)for(var g=0;f>g;++g)r=s.indexOf(a.at(l+g)),i=c[r],u(i).addClass(x),this.hasCheckbox()&&e(t(i),!0);if(f>0||p>0){var $=f-p;if($&&this.hasCheckbox()){var b=a.length,m=this.$thead[0],y=this.$tfoot[0],C=m.childNodes[0].childNodes[0],E=C.childNodes[0],k=C.childNodes[1],N=y.childNodes[0].childNodes[0],w=N.childNodes[1],S=N.childNodes[0];w.innerHTML=E.innerHTML=b,w.title=E.title=b,S.checked=k.checked=this.isSelected(),S.indeterminate=k.indeterminate=b>0&&s.length!==b}this.dispatchEvent("selectionchanged",function(){return{selection:this.$selection.toArray()}})}return this}};return n}(),X=function(){var e=function(t){var e=t||[];return i.isArray(e)||(e=[e]),i.map(e,function(t){var e=t.charAt(0);return e!==T&&e!==D?T+t:t})},n=function(t){var e="$"+t,n=this.$table;this[e]=u(R.byTagName(t,n[0])),this[e].length||(this[e]=u(R[t]())),n.append(this[e][0])},r=function(t){var e=this.options.events[t];e&&this.addEventListener(t.slice(2),this.options.events[t])},s=function(t,e){if(!(this instanceof s))return new s(t,e);var o=this.$table=u(t),a=this.options=e=e||{},h=s.options;i.forEach(i.keys(h),function(t){var e=a[t],n=h[t];if(i.isUndefined(e)){var r=j.toSpinalCase(t),s=o[0].getAttribute(r)||o[0].getAttribute("data-"+r);s&&(e=a[t]=j.parse(s))}i.isObject(n)&&(i.isObject(e)||i.isUndefined(e))&&(e=a[t]=i.defaults(e||{},n)),i.isUndefined(e)&&(e=a[t]=n)}),a.size={width:a.size.width,height:a.size.height},a.scrollable=a.scrollable||!!a.size.height,this.$data=new U(a.data,{key:a.key,model:a.model});var c=this.isSortable(),l=this.isDraggable();!a.columns||c&&!l||i.forEach(a.columns,function(t){c||(t.sortable=!1),l&&(t.draggable=!0)}),this.$columns=new U(a.columns,{key:"id",model:V});var d=a.scrollable,p=this.isSelectable(),v=this.isEditable();this.$sortBy=[],o.addClass(f),p&&o.addClass(C),d&&o.addClass(y),i.forEach([B,z,O],n,this),this.$data.observe(_.on,this),this.$columns.observe(Y.on,this),this.$$events={},c&&J.bindSort(this),v&&J.bindEdition(this),p&&(this.$selection=new U([],this.$data.options()),this.$selection.observe(Q.on,this),J.bindSelection(this)),this.$bus=new F,i.forEach(i.keys(a.events),r,this),this.isResizable()&&(this.resize(),J.bindResize(this)),this.renderHeader().renderFooter().sortBy(e.sortBy,!1).renderBody(),this.$data.clearChanges(),this.$columns.clearChanges(),l&&J.bindDragDrop(this),this.dispatchEvent("initialized")};return s.create=function(t,e){return new s(t,e)},s.prototype={data:function(){return this.$data},columns:function(){return this.$columns},selection:function(){return this.$selection},isEditable:function(){return this.options.editable||this.$columns.some(function(t){return!!t.editable})},isSortable:function(){return this.options.sortable},isSelectable:function(){var t=this.options.selection;return t&&t.enable},isResizable:function(){var t=this.options.size;return!!t.height||!!t.width},hasCheckbox:function(){return this.isSelectable()&&this.options.selection.checkbox},isSelected:function(t){if(!this.isSelectable())return!1;if(t)return this.$selection.contains(t);

var e=this.$data.length,n=this.$selection.length;return e>0&&e===n},isDraggable:function(){return!!this.options.dnd},render:function(){return this.renderHeader().renderFooter().renderBody(),this.$columns.clearChanges(),this.$data.clearChanges(),this},renderHeader:function(){var t=K.theadRow(this);return this.$thead.empty().append(t),this},renderFooter:function(){var t=K.tfootRow(this);return this.$tfoot.empty().append(t),this},renderBody:function(t){var e=null==t?this.options.async:t,n=this,r=i.once(function(){n.$tbody.empty()}),o=function(t,e){var i=K.tbodyRows(n,t,e);r(),n.$tbody.append(i)},s=function(){n.$data.clearChanges(),n.dispatchEvent("rendered",function(){return{data:this.$data,nodes:i.toArray(this.$tbody[0].childNodes)}}),n=r=o=s=null};return e?j.asyncTask(this.$data.split(200),10,o,s):(o(this.$data,0),s()),this},resize:function(){return G.resize(this),this},select:function(){return this.$selection.length!==this.$data.length&&this.$selection.add(this.$data.toArray()),this},deselect:function(){return this.$selection.isEmpty()||this.$selection.clear(),this},sortBy:function(t,n){var r=e(t);if(this.$sortBy===r||this.$sortBy.join()===r.join())return this;this.$sortBy=r;var s=this.$thead.children().eq(0).children(),a=this.$tfoot.children().eq(0).children();s.removeClass(v+" "+g).removeAttr(S),a.removeClass(v+" "+g).removeAttr(S);var u=this.$columns,h=this.hasCheckbox(),c=i.map(this.$sortBy,function(t){var e,n=t.charAt(0),r=t.substr(1),i=n===T,c=u.indexOf(r),l=h?c+1:c;return c>=0?(e=u.at(c),e.asc=i,s.eq(l).addClass(i?v:g).attr(S,n),a.eq(l).addClass(i?v:g).attr(S,n)):e={},{parser:e.$parser||o(t),fn:e.$comparator||I.$auto,desc:!i}});return this.$data.sort(H(c)),n!==!1&&this.renderBody(),this.dispatchEvent("sorted")},dispatchEvent:function(t,e){return this.$bus.dispatchEvent(this,t,e),this.$bus.dispatchEvent(this,"updated"),this},addEventListener:function(t,e){return this.$bus.addEventListener(t,e),this},removeEventListener:function(t,e){return this.$bus.removeEventListener(t,e),this},destroy:function(){this.$table.off(),this.$thead.off(),this.$tfoot.off(),this.$tbody.off(),this.$$events.onResize&&u(t).off("resize",this.$$events.onResize),this.$data.unobserve(),this.$columns.unobserve(),this.$selection.unobserve(),this.$bus.clear(),this.$$events=null,j.destroy(this)}},s.options={key:"id",data:null,columns:null,sortBy:null,async:!1,scrollable:!1,sortable:!0,editable:!1,dnd:!1,selection:{enable:!0,checkbox:!0,multi:!1},size:{width:null,height:null},events:{}},i.forEach(["onInitialized","onUpdated","onRendered","onDataSpliced","onDataChanged","onDataUpdated","onColumnsSpliced","onColumnsUpdated","onSelectionChanged","onSorted"],function(t){s.options.events[t]=null}),s}(),Z={Grid:X,addRenderer:function(t,e){return M[t]=e,Z},addComparator:function(t,e){return I[t]=e,Z}};c.provider("Waffle",function(){this.$get=function(){return Z},i.forEach(i.keys(Z),function(t){this[t]=Z[t]},this)}),c.directive("waffle",["$parse","$rootScope",function(t,e){return{restrict:"AE",replace:!1,require:"?ngModel",template:"<table><thead></thead><tbody></tbody></table>",link:function(n,r,o,s){var a=i.noop,u=function(t){var r=t||a;return e.$$phase?r():n.$apply(r)},h=r;"table"!==h[0].tagName.toLowerCase()&&(h=h.children().eq(0));var c=function(t){return t?function(){var e=arguments,n=this,r=u(function(){return t.apply(n,e)});return n=e=null,r}:void 0},l=function(){var e=o.waffleOptions||o.waffleGrid;return t(e)(n)||{}}();i.forEach(i.keys(X.options),function(t){!l[t]&&o[t]&&(l[t]=n.$eval(o[t]))});var d=t(o.waffleGrid).assign||i.noop,f=l.events=l.events||{};i.forEach(i.keys(X.options.events),function(t){var e=f[t]=c(f[t]);o[t]&&(f[t]=c(function(r){e&&e.call(this,r),n.$eval(o[t],{$event:r})}))});var p=X.create(h,l);d(n,p),p.addEventListener("updated",i.debounce(function(){u()},200)),p.isSelectable()&&(p.addEventListener("selectionchanged",function(t){u(function(){s&&s.$setViewValue(t.details.selection)})}),s&&(s.$formatters.push(function(t){return p.selection().reset(t),t}),s.$isEmpty=function(t){return!t||!t.length})),n.$on("$destroy",function(){p.destroy(),p=l=d=h=null})}}}])}(window,document,window.angular,void 0);