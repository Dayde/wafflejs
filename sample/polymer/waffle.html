<dom-module id="waffle-grid">
  <template>
    <content></content>
  </template>

  <script>
    Polymer({
      is: 'waffle-grid',

      properties: {
        options: {
          type: Object,
          notify: false
        }
      },

      ready: function() {
        // Get table element
        var $this = Polymer.dom(this);
        var table = $this.firstElementChild;

        // Create table if there is no content
        if (!table) {
          table = document.createElement('table');
          $this.appendChild(table);
        }

        // Initialize grid
        this.$grid = Waffle.Grid.create(table, this.options);

        // Bind Waffle events and trigger polymer events
        var eventListener = function(e) {
          this.fire(e.type, e.details);
        };

        var bindEvent = function(evtName) {
          var evt = evtName.slice(2);
          this.$grid.addEventListener(evtName.slice(2).toLowerCase(), eventListener.bind(this));
        };

        Object.keys(Waffle.Grid.options.events).forEach(bindEvent.bind(this));

        // Then flush dom modification
        Polymer.dom.flush();
      },

      // Detached callback
      detached: function() {
        var grid = this.grid();
        if (grid) {
          grid.destroy();
        }
      },

      // Return grid object
      grid: function() {
        return this.$grid;
      }
    });
  </script>
</dom-module>
